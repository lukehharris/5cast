{% extends "base.html" %}

{% block title %}5cast{% endblock %}

{% block extra_headers %}
<link href="/static/styles2.css" rel="stylesheet">
<script src="/static/underscore-min.js"></script>
<script src="/static/backbone-min.js"></script>
<!--script src="/static/deep-model.min.js"></script-->
<script src="/static/Chart.min.js"></script>
<script src="/static/highcharts/highcharts.js"></script>
<script src="/static/highcharts/highcharts-more.js"></script>
<script src="/static/highcharts/modules/exporting.js"></script>

<script type="text/javascript">
	function numberWithCommas(x) {
		x=x.toFixed(0);
	    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}
	function roundToHundreds(x){
		x=parseFloat(x).toFixed(0);
		return (Math.round(x/100)*100);
	}
</script>
<!-- MODELS -->
<script type="text/javascript">
var Case = Backbone.Model.extend({
	defaults : {
		name : 'Base Case',
		/*
		income_items : {'Salary':''},
		basic_expenses : {'Housing':'','Utilities':'','TV/Internet':'','Phone':'','Gym':'','Food':''},
		misc_expenses : {'Social/Entertainment':'','Other':''},
		debt_accounts : {'Student':{'payment':'','balance':'','rate':''},'Credit Card':{'payment':'','balance':'','rate':''}},
		cash_accounts : {'Checking':{'balance':'','rate':''},'Savings':{'balance':'','rate':''},'Investment':{'balance':'','rate':''}},
		*/
		//income_items : {'Salary':{'type':'flatline','value':''}},
		income_items : {'Salary':''},
		basic_expenses : {'Housing':{'type':'flatline','frequency':'monthly','value':''},
			'Utilities':{'type':'flatline','frequency':'monthly','value':''},
			'TV/Internet':{'type':'flatline','frequency':'monthly','value':''},
			'Phone':{'type':'flatline','frequency':'monthly','value':''},
			'Gym':{'type':'flatline','frequency':'monthly','value':''},
			'Food':{'type':'flatline','frequency':'monthly','value':''}
		},
		misc_expenses : {'Social/Entertainment':{'type':'flatline','value':''},'Other':{'type':'flatline','value':''}},
		debt_accounts : {'Student':{'payment':'','balance':'','rate':''},'Credit Card':{'payment':'','balance':'','rate':''}},
		cash_accounts : {'Checking':{'balance':'','rate':''},'Savings':{'balance':'','rate':''},'Investment':{'balance':'','rate':''}},
		isBaseCase: false,
		data : null //this is where the full model output is stored
	},
	urlRoot: '/case'
});

var CaseCollection = Backbone.Collection.extend({
    model: Case,
	urlRoot: '/case'
});
</script>

<!-- TEMPLATES -->
<script type="text/template" id="input_base_template">
	<div id="input_accordion" class="accordion">
		<div class="accordion-group" id="income_items_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-parent="#input_accordion" href="#collapseOne">
					Income
				</a>
			</div>
			<div id="collapseOne" class="accordion-body collapse in">
				<div class="accordion-inner" id="income_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="expense_items_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-parent="#input_accordion" href="#collapseTwo">
					Expenses
				</a>
			</div>
			<div id="collapseTwo" class="accordion-body collapse">
				<div class="accordion-inner" id="expenses_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="cash_accounts_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-parent="#input_accordion" href="#collapseThree">
					Assets
				</a>
			</div>
			<div id="collapseThree" class="accordion-body collapse">
				<div class="accordion-inner" id="assets_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="debt_accounts_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-parent="#input_accordion" href="#collapseFour">
					Debt
				</a>
			</div>
			<div id="collapseFour" class="accordion-body collapse">
				<div class="accordion-inner" id="debt_el">
					
				</div>
			</div>
		</div>
	</div>
	<div style="display:block;">
		<a id="save_input_data" class="btn btn-info" style="font-size:16pt;margin-top:20px; ">Save Data</a>
	</div>
</script>

<script type="text/template" id="income_input_template">
	<div class="input_item_labels">
		<div class="case_label">
			<div class="dropdown" style="display:inline-block; margin-left: 20px;">
				<a class="dropdown-toggle" data-toggle="dropdown" href="">Add Scenario</a>
				<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario">New Custom Scenario</a></li>
				   	<li class="divider" role="presentation"></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario1">20% reduction in housing expense</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario2">10% raise</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario3">$40k inheritance received, invested at 5%</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario4">100% of Debt Forgiven</a></li>
				</ul>
			</div>
		</div>
		<% _.each(_.keys(items), function(key){{'{'}} %>
			<div class="input_item_label">
				<button id="delete_in" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>
		<% });%>
	</div>
	<% models.each(function(model){{'{'}}%>
		<div class="input_section">
			<div class="case_label">
				<% if (!model.get('isBaseCase')) {{'{'}}%>
				<button class="close delete_scenario" data-id="<%=model.cid%>" title="Delete This Scenario">&times;</button>
				<%{{'}'}}%>
				<%=model.get('name')%>
			</div>
			<% _.each(_.keys(items), function(key){{'{'}} %>
				<div class="input_item">
					$<input class="<%=model.cid%>_input" type="text" name="in_<%=key%>" value="<%=model.get('income_items')[key]%>">per month
				</div>
			<% });%>
		</div>
	<%});%>
	<div>
		<a id="new_in" class="btn btn-info new_field"><i class="icon-plus"></i>Add New Income Source</a>
	</div>
</script>

<script type="text/template" id="expenses_input_template">
	<div class="case_labels">
		<div id="case_label_add_scenario" class="case_label">
			<div class="dropdown" style="display:inline-block; margin-left: 20px;">
				<a class="dropdown-toggle" data-toggle="dropdown" href="">Add Scenario</a>
				<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario">New Custom Scenario</a></li>
				   	<li class="divider" role="presentation"></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario1">20% reduction in housing expense</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario2">10% raise</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario3">$40k inheritance received, invested at 5%</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario4">100% of Debt Forgiven</a></li>
				</ul>
			</div>
		</div>
		<% models.each(function(model){{'{'}}%>
			<div class="case_label">
				<% if (!model.get('isBaseCase')) {{'{'}}%>
				<button class="close delete_scenario" data-id="<%=model.cid%>" title="Delete This Scenario">&times;</button>
				<%{{'}'}}%>
				<%=model.get('name')%>
			</div>
		<%});%>
	</div>
	<% _.each(_.keys(items), function(key){{'{'}} %>
		<div class="input_item_row">
			<div class="input_item_label">
				<button id="delete_be" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>
			<% models.each(function(model){{'{'}}%>

				<div class="input_item">
					<div class="input_item_sub input_sub_<%=model.cid%>" data-section="basic_expenses" data-name="<%=model.get('name')%>" data-input-type="<%=model.get('basic_expenses')[key]['type']%>" >
						<% if (model.get('basic_expenses')[key]['type'] == 'flatline') {{'{'}}%>
							$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
							<select class="input_period" name="frequency">
								<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
								<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
							</select>
						<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'pct_change'){{'{'}} %>
							$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
							<select class="input_period" name="frequency">
								<option value="yearly" <%if (model.get('basic_expenses')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
								<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
								<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
							</select>
							<br>
							and 
							<select class="input_period" name="change_direction" style="margin:8px 0;">
								<option value="increases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
								<option value="decreases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
							</select>
							 by
							<input type="text" name="change" value="<%=model.get('basic_expenses')[key]['change']%>" style="width:20px; margin:8px 0;">%
							<br>
							every  
							<input type="text" name="change_periods" value="<%=model.get('basic_expenses')[key]['change_periods']%>" style="width:20px;">
							<select class="input_period" name="change_frequency">
								<option value="year" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
								<option value="month" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
							</select>

						<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'val_change'){{'{'}} %>
							$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
							<select class="input_period" name="frequency">
								<option value="yearly" <%if (model.get('basic_expenses')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
								<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
								<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
							</select>
							<br>
							and 
							<select class="input_period" name="change_direction" style="margin:8px 0;">
								<option value="increases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
								<option value="decreases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
							</select>
							 by
							$<input type="text" name="change" value="<%=model.get('basic_expenses')[key]['change']%>" style="width:60px;">
							<br>
							every  
							<input type="text" name="change_periods" value="<%=model.get('basic_expenses')[key]['change_periods']%>" style="width:20px;">
							<select class="input_period" name="change_frequency">
								<option value="year" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
								<option value="month" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
							</select>
						<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'custom'){{'{'}} %>
							<% for (x=0;x<model.get('basic_expenses')[key]['data'].length;x++){{'{'}} %>
							<div class="custom_input_block">
								$<input type="text" name="be_<%=key%>" value="<%=model.get('basic_expenses')[key]['data'][x]['value']%>" style="margin:8px 0;"> 
								<select class="<%=model.cid%>_input input_period" name="ip_<%=key%>">
									<option value="monthly" <%if (model.get('basic_expenses')[key]['data'][x]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
									<option value="weekly" <%if (model.get('basic_expenses')[key]['data'][x]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
								</select>
								<br>
								from
								<select class="<%=model.cid%>_input input_period" data-period="start" name="ip_<%=key%>_mo" style="width:60px;">
									<%for(i=1;i<=12;i++){{'{'}} %>
										<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['start_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
									<%{{'}'}}%>
								</select> 
								<select class="<%=model.cid%>_input input_period" data-period="start" name="ip_<%=key%>_mo" style="width:76px;">
									<%for(i=2013;i<=2023;i++){{'{'}} %>
										<option value="<%=i-2012%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['start_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
									<%{{'}'}}%>
								</select>
								<br>
								to
								<select class="<%=model.cid%>_input input_period" data-period="end" name="ip_<%=key%>_mo" style="width:60px;margin:8px 0;">
									<%for(i=1;i<=12;i++){{'{'}} %>
										<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['end_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
									<%{{'}'}}%>
								</select> 
								<select class="<%=model.cid%>_input input_period" data-period="end" name="ip_<%=key%>_mo" style="width:76px">
									<%for(i=2013;i<=2023;i++){{'{'}} %>
										<option value="<%=i-2012%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['end_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
									<%{{'}'}}%>
								</select>
							</div>
							<%{{'}'}}%>
							<a class="btn btn-info" id="new_custom_input_block" href="#">Add Another Period</a>
						<%{{'}'}}%>
					</div>

					<div class="dropdown" style="display:inline-block; vertical-align:top; margin-top:4px; float:right;">
						<a class="dropdown-toggle" data-toggle="dropdown" href=""><i class="icon-cog" title="Change Input Type"></i></a>
						<ul class="dropdown-menu" role="menu" data-id="<%=model.cid%>" data-name="<%=key%>" data-section="basic_expenses" aria-labelledby="dLabel">
						   	<li role="presentation"><a href="#" role="menuitem" id="it_flatline">Flatline</a></li>
						   	<li role="presentation"><a href="#" role="menuitem" id="it_pct_change">Increase by %</a></li>
						   	<li role="presentation"><a href="#" role="menuitem" id="it_val_change">Increase by $</a></li>
						   	<li role="presentation"><a href="#" role="menuitem" id="it_custom">Custom</a></li>
						</ul>
					</div>
				</div>

			<%});%>
		</div>
	<% });%>
	

	<div>
		<a id="new_be" class="btn btn-info new_field"><i class="icon-plus"></i>Add New Expense</a>
	</div>
</script>

<script type="text/template" id="assets_input_template">
	<div class="input_item_labels">
		<div class="case_label">
			<div class="dropdown" style="display:inline-block; margin-left: 20px;">
				<a class="dropdown-toggle" data-toggle="dropdown" href="">Add Scenario</a>
				<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario">New Custom Scenario</a></li>
				   	<li class="divider" role="presentation"></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario1">20% reduction in housing expense</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario2">10% raise</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario3">$40k inheritance received, invested at 5%</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario4">100% of Debt Forgiven</a></li>
				</ul>
			</div>
		</div>
		<% _.each(_.keys(items), function(key){{'{'}} %>
			<div class="input_item_label" style="font-weight:bold;">
				<% if(key != 'Checking'){{'{'}}%>
				<button id="delete_ca" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%{{'}'}}%>
				<%=key%>
			</div>
			<div class="input_item_label">
				Current Balance
			</div>
			<div class="input_item_label">
				Expected Return
			</div>
			<div class="input_item_label">&nbsp;</div>	
		<% });%>
	</div>
	<% models.each(function(model){{'{'}}%>
		<div class="input_section">
			<div class="case_label">
				<% if (!model.get('isBaseCase')) {{'{'}}%>
					<button class="close delete_scenario" data-id="<%=model.cid%>" title="Delete This Scenario">&times;</button>
				<%{{'}'}}%>
				<%=model.get('name')%>
			</div>
			<% _.each(_.keys(items), function(key){{'{'}} %>
				<div class="input_item_label">&nbsp;</div>
				<div class="input_item">
					$<input class="<%=model.cid%>_input" type="text" name="cb_<%=key%>" value="<%=model.get('cash_accounts')[key]['balance']%>">
				</div>
				<div class="input_item">
					%<input class="<%=model.cid%>_input input_percentage" type="text" name="er_<%=key%>" value="<%=model.get('cash_accounts')[key]['rate']%>">
				</div>
				<div class="input_item_label">&nbsp;</div>
			<% });%>
		</div>
	<%});%>
	<div>
		<a id="new_ca" class="btn btn-info new_cash_account"><i class="icon-plus"></i>Add New Banking/Investment Account</a>
	</div>
</script>

<script type="text/template" id="debt_input_template">
	<div class="input_item_labels">
		<div class="case_label">
			<div class="dropdown" style="display:inline-block; margin-left: 20px;">
				<a class="dropdown-toggle" data-toggle="dropdown" href="">Add Scenario</a>
				<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario">New Custom Scenario</a></li>
				   	<li class="divider" role="presentation"></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario1">20% reduction in housing expense</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario2">10% raise</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario3">$40k inheritance received, invested at 5%</a></li>
				   	<li role="presentation"><a href="#" role="menuitem" id="new_scenario4">100% of Debt Forgiven</a></li>
				</ul>
			</div>
		</div>
		<% _.each(_.keys(items), function(key){{'{'}} %>
			<div class="input_item_label" style="font-weight:bold;">
				<button id="delete_da" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>
			<div class="input_item_label">
				Current Payment
			</div>
			<div class="input_item_label">
				Current Balance
			</div>
			<div class="input_item_label">
				APR
			</div>
			<div class="input_item_label">&nbsp;</div>

		<% });%>
	</div>
	<% models.each(function(model){{'{'}}%>
		<div class="input_section">
			<div class="case_label">
				<% if (!model.get('isBaseCase')) {{'{'}}%>
					<button class="close delete_scenario" data-id="<%=model.cid%>" title="Delete This Scenario">&times;</button>
				<%{{'}'}}%>
				<%=model.get('name')%>
			</div>
			<% _.each(_.keys(items), function(key){{'{'}} %>
				<div class="input_item_label">&nbsp;</div>
				<div class="input_item">
					$<input class="<%=model.cid%>_input" type="text" name="de_<%=key%>" value="<%=model.get('debt_accounts')[key]['payment']%>">per month
				</div>
				<div class="input_item">
					$<input class="<%=model.cid%>_input" type="text" name="ba_<%=key%>" value="<%=model.get('debt_accounts')[key]['balance']%>">
				</div>
				<div class="input_item">
					%<input class="<%=model.cid%>_input input_percentage" type="text" name="ra_<%=key%>" value="<%=model.get('debt_accounts')[key]['rate']%>">
				</div>
				<div class="input_item_label">&nbsp;</div>
			<% });%>
		</div>
	<%});%>
	<div>
		<a id="new_da" class="btn btn-info new_debt_account"><i class="icon-plus"></i>Add New Debt Account</a>
	</div>
</script>

<script type="text/template" id="table_1_template">
	<select id="table_1_menu">
		<option value="net_worth" <% if (value=='net_worth'){{'{'}}%> selected <%{{'}'}}%>  >Net Worth</option>
		<option value="net_income" <% if (value=='net_income'){{'{'}}%>selected<%{{'}'}}%>>Net Income</option>
	</select>
	<div>
		<table>
			<thead>
				<th>&nbsp;</th>
				<th>6 mon</th>
				<th>1 yr</th>
				<th>2 yr</th>
				<th>5 yr</th>
				<th>10 yr</th>
			</thead>
			<tbody>
				<% models.each(function(model){ %>
					<tr>
						<% if(value=='net_worth'){{'{'}}%>
							<td class="table_y_axis"><%=model.get('name')%></td>
							<td><%=numberWithCommas(roundToHundreds(model.get('data')[value][6]))%></td>
							<td><%=numberWithCommas(roundToHundreds(model.get('data')[value][12]))%></td>
							<td><%=numberWithCommas(roundToHundreds(model.get('data')[value][24]))%></td>
							<td><%=numberWithCommas(roundToHundreds(model.get('data')[value][60]))%></td>
							<td><%=numberWithCommas(roundToHundreds(model.get('data')[value][120]))%></td>
						<%{{'}'}}else{{'{'}}%>
							<td class="table_y_axis"><%=model.get('name')%></td>
							<td><%=numberWithCommas(model.get('data')[value][6])%></td>
							<td><%=numberWithCommas(model.get('data')[value][12])%></td>
							<td><%=numberWithCommas(model.get('data')[value][24])%></td>
							<td><%=numberWithCommas(model.get('data')[value][60])%></td>
							<td><%=numberWithCommas(model.get('data')[value][120])%></td>
						<%{{'}'}}%>
					</tr>
				<% });%>
			</tbody>
		</table>
	</div>
</script>

<script type="text/template" id="chart1_legend_template">
	<% for (i=0;i<names.length;i++){ %>
		<div class="legend_item" style="display:inline-block;">
		<div style="width:20px;height:20px;display:inline-block;background:<%=colors[i]%>">&nbsp;</div>
		<div style="font-weight:bold;display:inline-block;"><%=names[i]%></div>
	</div>
	<% }%>
</script>

<!-- VIEWS -->
<script type="text/javascript">
var ParentView = Backbone.View.extend({
	initialize: function(){
		self = this;
		{% if data_exists %}
			var this_model = new Case({id:{{base_id}} });
			this_model.fetch({
				success: function(){
					self.model.add(this_model); //add the new model to the collection
					self.render();

					var inputIncomeView = new InputIncomeView({el:$("#income_el"), model: self.model});
					var inputExpensesView = new InputExpensesView({el:$("#expenses_el"), model: self.model});
					var inputAssetsView = new InputAssetsView({el:$("#assets_el"), model: self.model});
					var inputDebtView = new InputDebtView({el:$("#debt_el"), model: self.model});

					var table1view = new Table1View({el:$('#table1'), model: self.model});
					var chart1view = new Chart1View({el:$('#chart1_legend'), model: self.model});
					var chart2view = new Chart2View({el:$('#chart2'), model: self.model});
				}
			});
		{% else %}
    		var this_model = new Case();
    		this_model.set('isBaseCase',true)
    		self.model.add(this_model); //add the new model to the collection
			self.render();

			var inputIncomeView = new InputIncomeView({el:$("#income_el"), model: self.model});
			var inputExpensesView = new InputExpensesView({el:$("#expenses_el"), model: self.model});
			var inputAssetsView = new InputAssetsView({el:$("#assets_el"), model: self.model});
			var inputDebtView = new InputDebtView({el:$("#debt_el"), model: self.model});

			//var table1view = new Table1View({el:$('#table1'), model: self.model});
			//var chart1view = new Chart1View({el:$('#chart1_legend'), model: self.model});
			//var chart2view = new Chart2View({el:$('#chart2'), model: self.model});
    	{% endif %}
    },
    render: function(){
    	var template = _.template( $("#input_base_template").html() );
    	this.$el.html( template );
    },
    events: {
        "click #save_input_data": "save_input_data",
    },
    save_input_data: function(callback){
    	this.model.each(function(model){
    		var cid = model.cid;

			$income_items = {};
			$basic_expenses = {};
			$misc_expenses = {};
			$debt_accounts = {};
			$cash_accounts = {};
			
			$de_items = [];
			$ba_items = [];
			$ra_items = [];
			$cb_items = [];
			$er_items = [];
			$this_name = '';
			var data = {};
			//$input = $('.'+cid+'_input');
			$input = $('.input_sub_'+cid);

			$input.each(function(){
				$input_type = $(this).attr('data-input-type');
				$section = $(this).attr('data-section');
				$name = $(this).attr('data-name');
				
				if($section == 'basic_expenses'){
					if($input_type == 'flatline'){
						$value = $(this).children('input').val();
						if($value == '') {$value = 0;}
						$frequency = $(this).children('select').val();
						$basic_expenses[$name] = {'type':$input_type,'frequency':$frequency,'value':$value};
					}else if($input_type == 'pct_change' || $input_type == 'val_change'){
						$value = $(this).children('input[name="value"]').val();
						if($value == '') {$value = 0;}
						$frequency = $(this).children('select[name="frequency"]').val();
						$change = $(this).children('input[name="change"]').val();
						$change_direction = $(this).children('select[name="change_direction"]').val();
						$change_frequency = $(this).children('select[name="change_frequency"]').val();
						$change_periods = $(this).children('input[name="change_periods"]').val();
						$basic_expenses[$name] = {'type':$input_type,'frequency':$frequency,'change':$change,'change_frequency':$change_frequency,'change_direction':$change_direction,'change_periods':$change_periods, 'value':$value};
					}else if($input_type == 'custom'){
						$periods = $(this).children('.custom_input_block');
						$data = [];
						$periods.each(function(){
							$value = $(this).children('input[name="value"]').val();
							if($value == '') {$value = 0;}
							$frequency = $(this).children('select[name="frequency"]').val();
							$start_mo = $(this).children('select[name="start_mo"]').val();
							$start_yr = $(this).children('select[name="start_yr"]').val();
							$end_mo = $(this).children('select[name="end_mo"]').val();
							$end_yr = $(this).children('select[name="end_yr"]').val();
							$data.push({'value':$value,'frequency':$frequency,'start_mo':$start_mo,'start_yr':$start_yr,'end_mo':$end_mo,'end_yr':$end_yr});
						});
					}
				}

				if($value == '') {$value = 0;}

				if($prefix == 'in') {
					$income_items[$name] = $value;
				}
				else if($prefix == 'be') {
					//$basic_expenses[$name] = $value;
					//alert($(this).attr('data-input-type'));
					$input_type = $(this).attr('data-input-type');
					$frequency = $(this).next().val();
					$basic_expenses[$name] = {'type':$input_type,'frequency':$frequency,'value':$value};
				}
				else if($prefix == 'me') {
					$misc_expenses[$name] = $value;
				}
				else if($prefix == 'de') {
					$de_items.push([$name,$value]);
				}
				else if($prefix == 'ba') { //debt balances
					$ba_items.push([$name,$value]);
				}
				else if($prefix == 'ra') { //debt rates
					$ra_items.push([$name,$value]);
				}
				else if($prefix == 'cb') { //cash balances
					$cb_items.push([$name,$value]);
				}
				else if($prefix == 'er') { //expected returns
					$er_items.push([$name,$value]);
				}
			});
			for (i=0;i<$de_items.length;i++) {
				var account_name = $de_items[i][0]
				$debt_accounts[account_name] = {'payment':$de_items[i][1],'balance':$ba_items[i][1],'rate':$ra_items[i][1]};
			}
			for (i=0;i<$cb_items.length;i++) {
				var account_name = $cb_items[i][0]
				$cash_accounts[account_name] = {'balance':$cb_items[i][1],'rate':$er_items[i][1]};
			}

		    model.save({
		    	income_items: $income_items,
		    	basic_expenses: $basic_expenses,
		    	misc_expenses: $misc_expenses,
		    	debt_accounts: $debt_accounts,
		    	cash_accounts: $cash_accounts
	    	},
	    	{
	    		//wait:true,
	        	success: function(model){
	        		console.log('success');
	        		if ($.type(callback) == 'function'){
						console.log('callback');
				    	callback();
				    }
	        	},
				error: function(){
				    console.log('error');
				}
	        });
		});

    return false;
	}
});

var InputIncomeView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('income_items');
    	var template = _.template( $("#income_input_template").html(), {models:this.model, items:items} );
    	this.$el.html( template );
    }
});
var InputExpensesView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('basic_expenses');
    	var template = _.template( $("#expenses_input_template").html(), {models:this.model, items:items} );
    	this.$el.html( template );
    }
});
var InputAssetsView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('cash_accounts');
    	var template = _.template( $("#assets_input_template").html(), {models:this.model, items:items} );
    	this.$el.html( template );
    }
});
var InputDebtView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('debt_accounts');
    	var template = _.template( $("#debt_input_template").html(), {models:this.model, items:items} );
    	this.$el.html( template );
    }
});


var Table1View = Backbone.View.extend({
	currentValue : 'net_worth',
    initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
        this.render();
    },
    render: function(){
    	var value = this.currentValue;
    	var template = _.template( $("#table_1_template").html(), {value:value,models:this.model} );
        this.$el.html( template );
    },
    events: {
        "change #table_1_menu": "update"
    },
    update: function( event ){
    	var value = event.currentTarget.value;
    	this.currentValue = value;
        this.render();
    }
});

var Chart1View = Backbone.View.extend({
	fillColors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
	strokeColors: ["rgba(151,187,205,1)", "rgba(153,230,153,1)"],
	pointColors: ["rgba(151,187,205,1)", "rgba(153,230,153,1)"],
	pointStrokeColors: ["#fff", "#fff"],
    initialize: function(){
    	var labels_all = Object.keys(this.model.at(0).get('data')['net_worth']);
    	var labels = [];
    	for (j=0;j<labels_all.length;j++){
    		labels.push(j);
			j+=11;
		}
		this.labels = labels;
    	
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
        this.render();
    },
    render: function(){
    	var datasets = [];
    	var legend_names = [];
    	
    	//console.log(this.model);
    	//console.log(this.model.length);
    	for (i=0;i<this.model.length;i++){
    		var data_dict = this.model.at(i).get('data')['net_worth'];
    		var data_list = []
    		for (j=0;j<(this.labels.length * 12);j++){
    			data_list.push(data_dict[j]);
    			j+=11;
    		}
    		var this_dataset = {
    			fillColor : this.fillColors[i],
    			strokeColor : this.strokeColors[i],
    			pointColor : this.pointColors[i],
    			pointStrokeColor : this.pointStrokeColors[i],
    			data : data_list
    		};
    		datasets.push(this_dataset);
    		legend_names.push(this.model.at(i).get('name'));
    	}



    	var template = _.template( $("#chart1_legend_template").html(), {names:legend_names, colors:this.strokeColors} );
        this.$el.html( template );

        //console.log($("#chart1"));
        //console.log($("#chart1").get(0));

        var ctx = $("#chart1_canvas").get(0).getContext("2d");
        //console.log(this.datasets);

		var Chart1_data = {
			labels: this.labels,
			datasets : datasets
		};
		new Chart(ctx).Line(Chart1_data,{bezierCurve : false});
    }
});

var Chart2View = Backbone.View.extend({
    initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
        this.render();
    },
    render: function(){
		var model = this.model.at(0);
		var income_items = [];
		var expenses = [];

		var inc_items = model.get('income_items');
		_.each(_.keys(inc_items), function(key){
			income_items.push({name:key,y:parseInt(inc_items[key])});
		});
		income_items.push({
            name: 'Total Income',
            isIntermediateSum: true,
            color: Highcharts.getOptions().colors[1]
        });
		var be_items = model.get('basic_expenses');
		_.each(_.keys(be_items), function(key){
			expenses.push({name:key,y:(-1)*parseInt(be_items[key]['value'])});
		});
		var me_items = model.get('misc_expenses');
		_.each(_.keys(me_items), function(key){
			expenses.push({name:key,y:(-1)*parseInt(me_items[key]['value'])});
		});
		var debt_accounts = model.get('debt_accounts');
		_.each(_.keys(debt_accounts), function(key){
			expenses.push({name:key,y:(-1)*parseInt(debt_accounts[key]['payment'])});
		});
		expenses.push({
            name: 'Net Income',
            isSum: true,
            color: Highcharts.getOptions().colors[1]
        });
        //console.log(income_items);
        //console.log(expenses);
        var data = income_items.concat(expenses);
        //console.log(data);

    	this.$el.highcharts({
        chart: {
            type: 'waterfall'
        },
        title: {
            text: 'Monthly Net Income Breakdown'
        },
        xAxis: {
            type: 'category'
        },
        yAxis: {
            title: {
                text: 'USD'
            }
        },
        legend: {
            enabled: false
        },
        exporting: {
        	enabled: false
        },
        credits: {
        	enabled: false
        },
        tooltip: {
            pointFormat: '<b>${point.y:,.0f}</b> USD'
        },
        series: [{
            upColor: Highcharts.getOptions().colors[2],
            color: Highcharts.getOptions().colors[3],
            data: data,
            /*
            data: [{
                name: 'Start',
                y: 120000
            }, {
                name: 'Product Revenue',
                y: 569000
            }, {
                name: 'Service Revenue',
                y: 231000
            }, {
                name: 'Positive Balance',
                isIntermediateSum: true,
                color: Highcharts.getOptions().colors[1]
            }, {
                name: 'Fixed Costs',
                y: -342000
            }, {
                name: 'Variable Costs',
                y: -233000
            }, {
                name: 'Balance',
                isSum: true,
                color: Highcharts.getOptions().colors[1]
            }],
            */
            dataLabels: {
                enabled: true,
                formatter: function () {
                    //return Highcharts.numberFormat(this.y / 1000, 0, ',') + 'k';
                    return Highcharts.numberFormat(this.y, 0, ',');
                },
                style: {
                    color: '#FFFFFF',
                    fontWeight: 'bold'
                }
            },
            pointPadding: 0
        }]
    });
    }
});

</script>

<script type="text/javascript">
$(document).ready(function() {
	$global_fieldnames = []

	var caseCollection = new CaseCollection();
	var parentView = new ParentView({el:$("#input"), model: caseCollection});

	var buildExistingCases = function(input_id) {
		var this_model = new Case({id: input_id});
		this_model.fetch({
			success: function(){
				caseCollection.add(this_model);
			}
		});	
	}
	{% for this_id in other_ids %}
		buildExistingCases({{this_id}});
	{% endfor %}

	
	

	$('#back_to_output').live('click',function(){
		$('#input').addClass('hidden');
		$('#output').removeClass('hidden');
		$(this).addClass('hidden');
		$('#back_to_input').removeClass('hidden');
	});
	$('#back_to_input').live('click',function(){
		$('#output').addClass('hidden');
		$('#input').removeClass('hidden');
		$(this).addClass('hidden');
		$('#back_to_output').removeClass('hidden');
	});

	$('#new_scenario').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var new_model = new Case({
				name:$case_name,
				data:base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario1').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var be = $.extend(true, {}, base_model.get('basic_expenses'));
		be['Housing'] = be['Housing'] * 0.8;
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: be,
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario2').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var inc = $.extend(true, {}, base_model.get('income_items'));
		inc['Salary'] = inc['Salary'] * 1.1;
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: inc,
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario3').live('click', function(){
		var accounts = null;
		caseCollection.each(function(model){
			accounts = model.get('cash_accounts');
			accounts['Inheritance'] = {'balance':0,'rate':0};
			model.set({cash_accounts:accounts});
			model.trigger('change');
		});
		Case.prototype.defaults.cash_accounts = accounts;
		
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var ca = $.extend(true, {}, base_model.get('cash_accounts'));
		ca['Inheritance'] = {'balance':40000,'rate':5};

		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: ca
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario4').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var da = $.extend(true, {}, base_model.get('debt_accounts'));
		for (var key in da) {
			da[key]['balance'] = 0;
			da[key]['payment'] = 0;
		}
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: da,
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});

	$('#it_flatline').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'flatline','frequency':'monthly','value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_pct_change').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'pct_change','frequency':'monthly','change':0,'change_frequency':'year','change_direction':'increases','change_periods':1,'value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_val_change').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'val_change','frequency':'monthly','change':0,'change_frequency':'year','change_direction':'increases','change_periods':1,'value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_custom').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'custom','data': [ {'value':0,'frequency':'monthly','start_mo':6,'start_yr':2013,'end_mo':7,'end_yr':2013} ] };
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#new_custom_input_block').live('click',function(){
		$parent = $(this).parent().next().children('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name]['data'].push({'value':0,'frequency':'monthly','start_mo':6,'start_yr':2013,'end_mo':7,'end_yr':2013});
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});





	$('#new_in').live('click',function(){
		//while (true) {
		//	$fieldname = prompt('Enter Item Name');
		//	if ($fieldname != null && $fieldname != '') {
		//		if($global_fieldnames.indexOf($fieldname.toLowerCase()) == -1) {

		/*
				}
				else {
					alert('You already have an item with the name \"'+$fieldname+'\".\r\nPlease use a new, unique name.');
				}
			}
			else {
				break;
			}	
		}
		*/
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			//console.log(_.size(parentView.caseViews));
			var in_items = null;
			//for (var case_number in parentView.caseViews){
			caseCollection.each(function(model){
				in_items = model.get('income_items');
				in_items[$fieldname] = 0;
				//console.log(in_items);
				model.set({income_items:in_items});
				//console.log(parentView.caseViews[case_number].model.get('income_items'));
				//console.log('ok');
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.income_items = in_items;
		//});
	});
	$('#new_be').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var be_items = null;
			caseCollection.each(function(model){
				be_items = model.get('basic_expenses');
				//be_items[$fieldname] = 0;
				be_items[$fieldname] = {'type':'flatline','frequency':'monthly','value':0};
				model.set({basic_expenses:be_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.basic_expenses = be_items;
		//});
	});
	$('#new_me').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var me_items = null;
			caseCollection.each(function(model){
				me_items = model.get('misc_expenses');
				me_items[$fieldname] = 0;
				model.set({misc_expenses:me_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.misc_expenses = me_items;
		//});
	});
	$('#new_da').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('debt_accounts');
				accounts[$fieldname] = {'payment':0,'balance':0,'rate':0};
				model.set({debt_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.debt_accounts = accounts;
		//});
	});
	$('#new_ca').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('cash_accounts');
				accounts[$fieldname] = {'balance':0,'rate':0};
				model.set({cash_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.cash_accounts = accounts;
		//});
	});

	$('#delete_in').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var in_items = null;
			caseCollection.each(function(model){
				in_items = model.get('income_items');
				delete in_items[$fieldname];
				model.set({income_items:in_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.income_items = in_items;
		});
	});
	$('#delete_be').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var be_items = null;
			caseCollection.each(function(model){
				be_items = model.get('basic_expenses');
				delete be_items[$fieldname];
				model.set({basic_expenses:be_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.be_items = be_items;
		});
	});
	$('#delete_me').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var me_items = null;
			caseCollection.each(function(model){
				me_items = model.get('misc_expenses');
				delete me_items[$fieldname];
				model.set({misc_expenses:me_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.me_items = me_items;
		});
	});
	$('#delete_da').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('debt_accounts');
				delete accounts[$fieldname];
				model.set({debt_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.debt_accounts = accounts;
		});
	});
	$('#delete_ca').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var accounts
			caseCollection.each(function(model){
				accounts = model.get('cash_accounts');
				delete accounts[$fieldname];
				model.set({cash_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.cash_accounts = accounts;
		});
	});

	$('.delete_scenario').live('click',function() {
		$cid = $(this).attr('data-id');
		//console.log($cid);
		caseCollection.get($cid).destroy({success:function(){console.log('destroyed')}});
	});


});

</script>

{% endblock %}

{% block main %}


<div id="input" style="margin:30px;">
	
</div>

<div id="output" class="hidden">
	<div class="content_box">
		<h2>Net Worth</h2>
		<div id="table1" style="margin-bottom:40px;"></div>
		<div id="chart1" style="text-align:center;">
			<div><h3>Projected Net Worth over Time</h3></div>
			<canvas id="chart1_canvas" width="800" height="400" style="display: inline;"></canvas>
			<div id="chart1_legend"></div>
		</div>
		<div class="form_section_divider" style="margin-top:80px;"></div>
		<h2>Cash Flow</h2>
		<div id="chart2" style="width: 800px; height: 400px; margin: 0 auto;text-align:center;"></div>
		<div class="form_section_divider" style="margin-top:80px;"></div>
		<h2>Debt Summary</h2>
</div>


{% endblock %}