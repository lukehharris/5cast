{% extends "base.html" %}

{% block title %}5cast{% endblock %}

{% block extra_headers %}
<link href="/static/styles2.css" rel="stylesheet">
<script src="/static/underscore-min.js"></script>
<script src="/static/backbone-min.js"></script>
<script src="/static/Chart.min.js"></script>
<script src="/static/highcharts/highcharts.js"></script>
<script src="/static/highcharts/highcharts-more.js"></script>
<script src="/static/highcharts/modules/exporting.js"></script>

<script type="text/javascript">
	function numberWithCommas(x) {
		x=x.toFixed(0);
	    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}
	function roundToHundreds(x){
		x=parseFloat(x).toFixed(0);
		return (Math.round(x/100)*100);
	}
	function month_conversion(month_number){
		var months = ['Jul','Aug','Sep','Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun'];
		//var years = [' \'13',' \'14',' \'15',' \'16',' \'17',' \'18',' \'19',' \'20',' \'21',' \'22',' \'23'];
		var month = months[(month_number-1)%12];
		//var year = years[Math.floor((month_number+5)/12)];
		var year = ' \'' + (13 + Math.floor((month_number+5)/12));
		return month + year;
	}
	var getActiveModel = function(collection){
		var this_model = false;
		collection.each(function(model){
			if(model.get('isActive')==true){
				this_model = model;
			}
		});
		return this_model;
	}
</script>

<!-- MODELS -->
<script type="text/javascript">
var Case = Backbone.Model.extend({
	defaults : {
		name : 'Base Case',
		income_items : {'Salary':{'type':'flatline','frequency':'monthly','value':''}},
		basic_expenses : {'Housing':{'type':'flatline','frequency':'monthly','value':''},
			'Utilities':{'type':'flatline','frequency':'monthly','value':''},
			'TV/Internet':{'type':'flatline','frequency':'monthly','value':''},
			'Phone':{'type':'flatline','frequency':'monthly','value':''},
			'Gym':{'type':'flatline','frequency':'monthly','value':''},
			'Food':{'type':'flatline','frequency':'monthly','value':''}
		},
		misc_expenses : {'Social/Entertainment':{'type':'flatline','value':''},'Other':{'type':'flatline','value':''}},
		debt_accounts : {'Student':{'payment':'','balance':'','rate':''},'Credit Card':{'payment':'','balance':'','rate':''}},
		cash_accounts : {'Checking':{'balance':'','rate':''},'Savings':{'balance':'','rate':''},'Investment':{'balance':'','rate':''}},
		isBaseCase: false,
		isActive: false, //this indicates which case gets shown alongside base case
		data : null //this is where the full model output is stored
	},
	urlRoot: '/case'
});

var CaseCollection = Backbone.Collection.extend({
    model: Case,
	urlRoot: '/case'
});
</script>

<!-- TEMPLATES -->
<script type="text/template" id="input_base_template">
	<div id="input_accordion" class="accordion">
		<div class="accordion-group" id="income_items_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-target="#collapseOne">
					Income
				</a>
			</div>
			<div id="collapseOne" class="accordion-body collapse in">
				<div class="accordion-inner" id="income_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="expense_items_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-target="#collapseTwo">
					Expenses
				</a>
			</div>
			<div id="collapseTwo" class="accordion-body collapse">
				<div class="accordion-inner" id="expenses_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="cash_accounts_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-target="#collapseThree">
					Assets
				</a>
			</div>
			<div id="collapseThree" class="accordion-body collapse">
				<div class="accordion-inner" id="assets_el">
					
				</div>
			</div>
		</div>
		<div class="accordion-group" id="debt_accounts_accordion_group">
			<div class="accordion-heading">
				<a class="accordion-toggle" data-toggle="collapse" data-target="#collapseFour">
					Debt
				</a>
			</div>
			<div id="collapseFour" class="accordion-body collapse">
				<div class="accordion-inner" id="debt_el">
					
				</div>
			</div>
		</div>
	</div>
	<div style="display:block;">
		<a id="save_input_data" class="btn btn-info" style="font-size:16pt;margin-top:20px; ">Save Data</a>
	</div>
</script>

<script type="text/template" id="income_input_template">
	<% _.each(_.keys(items), function(key){{'{'}} %>
		<div class="input_item_row">
			<div class="input_item_label">
				<button id="delete_in" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>

			<div class="input_item">

				<div class="dropdown change_input_type">
					<a class="dropdown-toggle" data-toggle="dropdown" href=""><i class="icon-cog" title="Change Input Type"></i></a>
					<ul class="dropdown-menu" role="menu" data-id="<%=model.cid%>" data-name="<%=key%>" data-section="income_items" aria-labelledby="dLabel">
					   	<li role="presentation"><a href="#" role="menuitem" id="it_flatline">Flatline</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_pct_change">Increase by %</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_val_change">Increase by $</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_custom">Custom</a></li>
					</ul>
				</div>

				<div class="input_item_sub input_sub_<%=model.cid%>" data-section="income_items" data-name="<%=key%>" data-input-type="<%=model.get('income_items')[key]['type']%>" >
					<% if (model.get('income_items')[key]['type'] == 'flatline') {{'{'}}%>
						$<input type="text" name="value" value="<%=model.get('income_items')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="monthly" <%if (model.get('income_items')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('income_items')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
					<%{{'}'}}else if(model.get('income_items')[key]['type'] == 'pct_change'){{'{'}} %>
						$<input type="text" name="value" value="<%=model.get('income_items')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="yearly" <%if (model.get('income_items')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
							<option value="monthly" <%if (model.get('income_items')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('income_items')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
						<br>
						and 
						<select class="input_period" name="change_direction" style="margin:8px 4px;">
							<option value="increases" <%if (model.get('income_items')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
							<option value="decreases" <%if (model.get('income_items')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
						</select>
						 by
						<input type="text" name="change" value="<%=model.get('income_items')[key]['change']%>" style="width:40px; margin:8px 0 8px 4px;">%
						every  
						<input type="text" name="change_periods" value="<%=model.get('income_items')[key]['change_periods']%>" style="width:20px;">
						<select class="input_period" name="change_frequency">
							<option value="year" <%if (model.get('income_items')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
							<option value="month" <%if (model.get('income_items')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
						</select>
					<%{{'}'}}else if(model.get('income_items')[key]['type'] == 'val_change'){{'{'}} %>
						$<input type="text" name="value" value="<%=model.get('income_items')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="yearly" <%if (model.get('income_items')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
							<option value="monthly" <%if (model.get('income_items')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('income_items')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
						<br>
						and 
						<select class="input_period" name="change_direction" style="margin:8px 0;">
							<option value="increases" <%if (model.get('income_items')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
							<option value="decreases" <%if (model.get('income_items')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
						</select>
						 by
						$<input type="text" name="change" value="<%=model.get('income_items')[key]['change']%>" style="width:60px;">
						every  
						<input type="text" name="change_periods" value="<%=model.get('income_items')[key]['change_periods']%>" style="width:20px;">
						<select class="input_period" name="change_frequency">
							<option value="year" <%if (model.get('income_items')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
							<option value="month" <%if (model.get('income_items')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
						</select>
					<%{{'}'}}else if(model.get('income_items')[key]['type'] == 'custom'){{'{'}} %>
						<% for (x=0;x<model.get('income_items')[key]['data'].length;x++){{'{'}} %>
						<div class="custom_input_block">
							$<input type="text" name="value" value="<%=model.get('income_items')[key]['data'][x]['value']%>"> 
							<select class="input_period" name="frequency">
								<option value="monthly" <%if (model.get('income_items')[key]['data'][x]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
								<option value="weekly" <%if (model.get('income_items')[key]['data'][x]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
							</select>
							<br>
							<span style="position:relative;top:4px;">from</span>
							<select class="input_period" name="start_mo" style="width:60px;margin-top:8px;">
								<%for(i=1;i<=12;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('income_items')[key]['data'][x]['start_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select> 
							<select class="input_period" name="start_yr" style="width:76px;margin-top:8px;">
								<%for(i=2013;i<=2023;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('income_items')[key]['data'][x]['start_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select>
							<span style="position:relative;top:4px;">through</span>
							<select class="input_period" name="end_mo" style="width:60px;margin-top:8px;">
								<%for(i=1;i<=12;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('income_items')[key]['data'][x]['end_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select> 
							<select class="input_period" name="end_yr" style="width:76px;margin-top:8px;">
								<%for(i=2013;i<=2023;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('income_items')[key]['data'][x]['end_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select>
						</div>
						<%{{'}'}}%>
						<a class="btn btn-info" id="new_custom_input_block" href="#">Add Another Period</a>
					<%{{'}'}}%>
				</div>
			</div>
		</div>
	<% });%>
	<div>
		<a id="new_in" class="btn btn-info new_field"><i class="icon-plus"></i>Add New Income Source</a>
	</div>
</script>

<script type="text/template" id="expenses_input_template">
	<% _.each(_.keys(items), function(key){{'{'}} %>
		<div class="input_item_row">
			<div class="input_item_label">
				<button id="delete_be" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>

			<div class="input_item">

				<div class="dropdown change_input_type">
					<a class="dropdown-toggle" data-toggle="dropdown" href=""><i class="icon-cog" title="Change Input Type"></i></a>
					<ul class="dropdown-menu" role="menu" data-id="<%=model.cid%>" data-name="<%=key%>" data-section="basic_expenses" aria-labelledby="dLabel">
					   	<li role="presentation"><a href="#" role="menuitem" id="it_flatline">Flatline</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_pct_change">Increase by %</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_val_change">Increase by $</a></li>
					   	<li role="presentation"><a href="#" role="menuitem" id="it_custom">Custom</a></li>
					</ul>
				</div>

				<div class="input_item_sub input_sub_<%=model.cid%>" data-section="basic_expenses" data-name="<%=key%>" data-input-type="<%=model.get('basic_expenses')[key]['type']%>" >
					<% if (model.get('basic_expenses')[key]['type'] == 'flatline') {{'{'}}%>
						$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
					<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'pct_change'){{'{'}} %>
						$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="yearly" <%if (model.get('basic_expenses')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
							<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
						<br>
						and 
						<select class="input_period" name="change_direction" style="margin:8px 4px;">
							<option value="increases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
							<option value="decreases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
						</select>
						 by
						<input type="text" name="change" value="<%=model.get('basic_expenses')[key]['change']%>" style="width:40px; margin:8px 0 8px 4px;">%
						every  
						<input type="text" name="change_periods" value="<%=model.get('basic_expenses')[key]['change_periods']%>" style="width:20px;">
						<select class="input_period" name="change_frequency">
							<option value="year" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
							<option value="month" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
						</select>
					<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'val_change'){{'{'}} %>
						$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['value']%>">
						<select class="input_period" name="frequency">
							<option value="yearly" <%if (model.get('basic_expenses')[key]['frequency'] == 'yearly') {{'{'}}%>selected<%{{'}'}}%>>Yearly</option>
							<option value="monthly" <%if (model.get('basic_expenses')[key]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
							<option value="weekly" <%if (model.get('basic_expenses')[key]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
						</select>
						<br>
						and 
						<select class="input_period" name="change_direction" style="margin:8px 0;">
							<option value="increases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'increases') {{'{'}}%>selected<%{{'}'}}%>>Increases</option>
							<option value="decreases" <%if (model.get('basic_expenses')[key]['change_direction'] == 'decreases') {{'{'}}%>selected<%{{'}'}}%>>Decreases</option>
						</select>
						 by
						$<input type="text" name="change" value="<%=model.get('basic_expenses')[key]['change']%>" style="width:60px;">
						every  
						<input type="text" name="change_periods" value="<%=model.get('basic_expenses')[key]['change_periods']%>" style="width:20px;">
						<select class="input_period" name="change_frequency">
							<option value="year" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'year') {{'{'}}%>selected<%{{'}'}}%>>year(s)</option>
							<option value="month" <%if (model.get('basic_expenses')[key]['change_frequency'] == 'month') {{'{'}}%>selected<%{{'}'}}%>>month(s)</option>
						</select>
					<%{{'}'}}else if(model.get('basic_expenses')[key]['type'] == 'custom'){{'{'}} %>
						<% for (x=0;x<model.get('basic_expenses')[key]['data'].length;x++){{'{'}} %>
						<div class="custom_input_block">
							$<input type="text" name="value" value="<%=model.get('basic_expenses')[key]['data'][x]['value']%>"> 
							<select class="input_period" name="frequency">
								<option value="monthly" <%if (model.get('basic_expenses')[key]['data'][x]['frequency'] == 'monthly') {{'{'}}%>selected<%{{'}'}}%>>Monthly</option>
								<option value="weekly" <%if (model.get('basic_expenses')[key]['data'][x]['frequency'] == 'weekly') {{'{'}}%>selected<%{{'}'}}%>>Weekly</option>
							</select>
							<br>
							<span style="position:relative;top:4px;">from</span>
							<select class="input_period" name="start_mo" style="width:60px;margin-top:8px;">
								<%for(i=1;i<=12;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['start_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select> 
							<select class="input_period" name="start_yr" style="width:76px;margin-top:8px;">
								<%for(i=2013;i<=2023;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['start_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select>
							<span style="position:relative;top:4px;">through</span>
							<select class="input_period" name="end_mo" style="width:60px;margin-top:8px;">
								<%for(i=1;i<=12;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['end_mo']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select> 
							<select class="input_period" name="end_yr" style="width:76px;margin-top:8px;">
								<%for(i=2013;i<=2023;i++){{'{'}} %>
									<option value="<%=i%>" <%if(i==model.get('basic_expenses')[key]['data'][x]['end_yr']){{'{'}}%>selected<%{{'}'}} %>><%=i%></option>
								<%{{'}'}}%>
							</select>
						</div>
						<%{{'}'}}%>
						<a class="btn btn-info" id="new_custom_input_block" href="#">Add Another Period</a>
					<%{{'}'}}%>
				</div>
			</div>
		</div>
	<% });%>
	<div>
		<a id="new_be" class="btn btn-info new_field"><i class="icon-plus"></i>Add New Expense</a>
	</div>
</script>

<script type="text/template" id="assets_input_template">
	<% _.each(_.keys(items), function(key){{'{'}} %>
		<div class="input_item_row">
			<div class="input_item_label">
				<% if(key != 'Checking'){{'{'}}%>
				<button id="delete_ca" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%{{'}'}}%>
				<%=key%>
			</div>

			<div class="input_item" style="height:80px;">
				<div class="input_item_sub input_sub_<%=model.cid%>" data-section="cash_accounts" data-name="<%=key%>">
					<span>
						<label>Current Balance</label>
						$<input type="text" name="balance" value="<%=model.get('cash_accounts')[key]['balance']%>">
					</span>
					<br>
					<span style="position:relative; top:8px;">
						<label>Expected Return</label>
						<input type="text" name="rate" value="<%=model.get('cash_accounts')[key]['rate']%>" style="margin-left:12px;">%
					</span>
				</div>
			</div>
		</div>
	<% });%>
	<div>
		<a id="new_ca" class="btn btn-info new_cash_account"><i class="icon-plus"></i>Add New Banking/Investment Account</a>
	</div>
</script>

<script type="text/template" id="debt_input_template">
	<% _.each(_.keys(items), function(key){{'{'}} %>
		<div class="input_item_row">
			<div class="input_item_label">
				<button id="delete_da" class="close" data-name="<%=key%>" title="Delete This Item">&times;</button>
				<%=key%>
			</div>

			<div class="input_item" style="height:120px;">
				<div class="input_item_sub input_sub_<%=model.cid%>" data-section="debt_accounts" data-name="<%=key%>">
					<span>
						<label>Minimum Payment</label>
						$<input type="text" name="payment" value="<%=model.get('debt_accounts')[key]['payment']%>">
					</span>
					<br>
					<span style="position:relative; top:8px;">
						<label>Current Balance</label>
						$<input type="text" name="balance" value="<%=model.get('debt_accounts')[key]['balance']%>">
					</span>
					<br>
					<span style="position:relative; top:16px;">
						<label>APR</label>
						<input type="text" name="rate" value="<%=model.get('debt_accounts')[key]['rate']%>" style="margin-left:12px;">%
					</span>
				</div>
			</div>
		</div>
	<% });%>
	<div>
		<a id="new_da" class="btn btn-info new_debt_account"><i class="icon-plus"></i>Add New Debt Account</a>
	</div>
</script>

<script type="text/template" id="input_right_template">
	
		<h5>Current Monthly Net Income: </h5>
		<strong>$<%=numberWithCommas(data['net_income_raw'][1])%></strong>
		<h5>Current Net Worth: </h5>
		<strong>$<%=numberWithCommas(data['net_worth'][1])%></strong>
		<h5>Net Worth in 1 Year: </h5>
		<strong>$<%=numberWithCommas(data['net_worth'][12])%></strong>
		<h5>Net Worth in 5 Years: </h5>
		<strong>$<%=numberWithCommas(data['net_worth'][60])%></strong>
</script>

<script type="text/template" id="net_worth_tables_template">
	<div id="net_worth_tables_left" class="left_case_container">
		<h3 class="case_name">Base Case</h3>
		<table>
			<thead>
				<th>&nbsp;</th>
				<th>Today</th>
				<th>6 mon</th>
				<th>1 yr</th>
				<th>2 yr</th>
				<th>5 yr</th>
				<th>10 yr</th>
			</thead>
			<tbody>
				<tr>
					<td class="table_y_axis">Assets</td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][0]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][6]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][12]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][24]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][60]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['cash_accounts']['total'][120]))%></td>
				</tr>
				<tr>
					<td class="table_y_axis">Debt</td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][0]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][6]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][12]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][24]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][60]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['debt_accounts']['total_debt'][120]))%></td>
				</tr>
				<tr>
					<td class="table_y_axis">Net Worth</td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][0]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][6]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][12]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][24]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][60]))%></td>
					<td>$<%=numberWithCommas(roundToHundreds(model_left_data['net_worth'][120]))%></td>
				</tr>
			</tbody>
		</table>
	</div>
	<div id="net_worth_tables_right" class="right_case_container">
		<%if(model_right_data){{'{'}}%>
			<h3 class="case_name"><%=model_right_data['name']%></h3>
			<table>
				<thead>
					<th>&nbsp;</th>
					<th>Today</th>
					<th>6 mon</th>
					<th>1 yr</th>
					<th>2 yr</th>
					<th>5 yr</th>
					<th>10 yr</th>
				</thead>
				<tbody>
					<tr>
						<td class="table_y_axis">Assets</td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][0]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][6]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][12]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][24]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][60]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['cash_accounts']['total'][120]))%></td>
					</tr>
					<tr>
						<td class="table_y_axis">Debt</td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][0]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][6]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][12]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][24]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][60]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['debt_accounts']['total_debt'][120]))%></td>
					</tr>
					<tr>
						<td class="table_y_axis">Net Worth</td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][0]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][6]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][12]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][24]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][60]))%></td>
						<td>$<%=numberWithCommas(roundToHundreds(model_right_data['net_worth'][120]))%></td>
					</tr>
				</tbody>
			</table>
		<%{{'}'}}else{{'{'}}%>
		<h3 class="case_name">[No Active Case]</h3>
		<%{{'}'}}%>
	</div>

	<!--div id="net_worth_tables_divider"></div-->
</script>

<script type="text/template" id="cashflow_template">
	<div id="cashflow_left" class="left_case_container">
		<h3 class="case_name">Base Case</h3>
		<%if(data_left['insolvent'] == false){{'{'}} %>
			<%if(data_left['net_income'][1] >= 0){{'{'}}%>
				<div id="cashflow_left_pie" style="min-width: 470px; height:350px;"></div>
				<div style="position:relative;top:-20px;">
					<h4>Total Income: $<%=numberWithCommas(data_left['income']['total'][1])%></h4>
					<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_left['amount'])%></h4>
					<h4 style="border-top:1px solid gray;width:50%;">Net Income: <span style="color:#4DB870;">$<%=numberWithCommas(data_left['net_income_raw'][1])%></span></h4>
				</div>
				<div id="cashflow_net_income_usage" style="margin-top:40px;margin-bottom:40px;">
					<span style="font-weight:bold;font-size:14pt;text-decoration:underline;">You should use your positive net income to:</span>
					<br>
					<%for(i=0;i<data_left['NI_allocation'].length;i++){{'{'}}%>
						<%if(data_left['NI_allocation'][i]['type'] == 'debt_accounts'){{'{'}}%>
							<h5><%=i+1%>) Pay Down Your <%=data_left['NI_allocation'][i]['name']%> Debt</h5>
							<ul>
								<li>Pay $<%=numberWithCommas(data_left['NI_allocation'][i]['total_payment'])%> per month ($<%=numberWithCommas(data_left['NI_allocation'][i]['minimum_payment'])%> minimum + $<%=numberWithCommas(data_left['NI_allocation'][i]['extra_payment'])%> extra) starting in <%=month_conversion(data_left['NI_allocation'][i]['start_date'])%></li>
								<li>This debt will be paid off by <%=month_conversion(data_left['NI_allocation'][i]['payoff_date'])%> (see the Debt Summary section for details)</li>
							</ul>
						<%{{'}'}}else{{'{'}}%>
							<% if(data_left['NI_allocation'][i]['contribution'] > 0){{'{'}}%>
								<h5><%=i+1%>) Contribute to Your <%=data_left['NI_allocation'][i]['name']%> Account</h5>
								<ul>
									<li>Contribute $<%=numberWithCommas(data_left['NI_allocation'][i]['contribution'])%> per month starting in <%=month_conversion(data_left['NI_allocation'][i]['start_date'])%></li>
									<li>You can expect to have about $<%=numberWithCommas(roundToHundreds(data_left['NI_allocation'][i]['end_balance']))%> in the account 10 years from now (see the Assets Summary section for details)</li>
								</ul>
							<%{{'}'}}%>
						<%{{'}'}}%>
					<%{{'}'}}%>
				</div>
				<div class="case_section_divider"></div>
				<div id="survival_period" style="margin-top:20px;">	
					<%if(data_left['survival_period']['months_remaining'] == 'no expenses'){ %>
						No expenses entered yet
					<%}else if(data_left['survival_period']['months_remaining'] == '>10'){{'{'}}%>
						<p style="font-size:16px;">
							If your income suddenly went to zero, you could survive for <strong>more than 10 years</strong>.
						</p>
					<%}else{ %>

						<h4 style="margin:10px 0;">Survial Without Income</h4>
						<p style="font-size:16px;">
							If your income suddenly went to zero, you could survive for <strong>about <%=data_left['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
						</p>
						<%if(data_left['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
							<table>
								<thead>
									<th>&nbsp;</th>
									<th>Today</th>
									<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
										<th><%=month_conversion(i)%></th>
									<%{{'}'}}%>
								</thead>
								<tbody>
									<tr>
										<td>Beginning Balance</td>
										<td>&nbsp;</td>
										<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][i])%></td>
										<%{{'}'}}%>
									</tr>
									<tr>
										<td>- <%=data_left['survival_period']['deduction']%></td>
										<td>&nbsp;</td>
										<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][i])%></td>
										<%{{'}'}}%>
									</tr>
									<tr>
										<td>= Ending Balance</td>
										<%for(i=0;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][i])%></td>
										<%{{'}'}}%>
									</tr>
								</tbody>
							</table>
						<%{{'}'}}else if(data_left['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
							<table>
								<thead>
									<th>&nbsp;</th>
									<th>Today</th>
									<th><%=future_months[0]%></th>
									<th>...</th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-2)%></th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-1)%></th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded'])%></th>
								</thead>
								<tbody>
									<tr>
										<td>Beginning Balance</td>
										<td>&nbsp;</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
									<tr>
										<td>- <%=data_left['survival_period']['deduction']%></td>
										<td>&nbsp;</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
									<tr>
										<td>= Ending Balance</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][0])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
								</tbody>
							</table>
						<%{{'}'}}%>					
						<div style="margin-left:56px;">
							<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
								This assumes:
							</p>
							<ul style="font-size:12px;">
								<li>You make only the minimum payments on your debt (if applicable)</li>
								<li>Your expenses remain as currently projected</li>
								<li>You don&apos;t borrow money</li>
								<li>All of your assets are liquid and usable to fund your expenses</li>
							</ul>
						</div>				
					<%}%>
				</div>
			<%{{'}'}}else if(dat_left['net_income'][1] < 0){{'{'}}%>
				<div>
					<h4>Total Income: $<%=numberWithCommas(data_left['income']['total'][1])%></h4>
					<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_left['amount'])%></h4>
					<h4 style="border-top:1px solid gray;width:50%;color:#FF6666;">Net Income: $<%=numberWithCommas(data_left['net_income_raw'][1])%></h4>
				</div>
				<div id="expense_breakdown" style="margin-top:40px;">
					<table>
						<thead>
							<th>Expense Category</th>
							<th>Amount</th>
							<th>% of Total Income</th>
						</thead>
						<tbody>
							<%for(i=0;i<expenses_left.length;i++){{'{'}} %>
								<tr>
									<td><%=expenses_left[i]['name']%></td>
									<td>$<%=numberWithCommas(expenses_left[i]['amount'])%></td>
									<td><%=expenses_left[i]['pct']%>%</td>
								</tr>
							<% {{'}'}} %>
								<tr>
									<td class="table_y_axis">Total Expenses</td>
									<td><strong>$<%=numberWithCommas(expenses_totals_left['amount'])%></strong></td>
									<td><strong><%=expenses_totals_left['pct']%>%</strong></td>
								</tr>
								<tr style="color:#FF6666;">
									<td class="table_y_axis">Net Income</td>
									<td><strong>$<%=numberWithCommas(Math.round(data_left['net_income_raw'][1]))%></strong></td>
									<td><strong><%=Math.round((100.0 - expenses_totals_left['pct'])*10)/10%>%</strong></td>
								</tr>
						</tbody>
					</table>
				</div>
				<div style="margin-top:40px;margin-bottom:40px;font-size:16px;">
					<p style="font-weight:bold">
						You are currently running a net income deficit, but you are not projected to have any near-term solvency issues.
					</p>
				</div>
				<div id="survival_period" style="margin-top:20px;">
					<%if(data_left['survival_period']['months_remaining'] == 'no expenses'){ %>
						No expenses entered yet
					<%}else if(data_left['survival_period']['months_remaining'] == '>10'){{'{'}}%>
						<p style="font-size:16px;">
							If your income suddenly went to zero, you could survive for <strong>more than 10 years</strong>.
						</p>
					<%}else{ %>
						<h4 style="margin:10px 0;">Survial Without Income</h4>
						<p style="font-size:16px;">
							If your income suddenly went to zero, you could survive for <strong>about <%=data_left['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
						</p>
						<%if(data_left['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
							<table>
								<thead>
									<th>&nbsp;</th>
									<th>Today</th>
									<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
										<th><%=month_conversion(i)%></th>
									<%{{'}'}}%>
								</thead>
								<tbody>
									<tr>
										<td>Beginning Balance</td>
										<td>&nbsp;</td>
										<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][i])%></td>
										<%{{'}'}}%>
									</tr>
									<tr>
										<td>- <%=data_left['survival_period']['deduction']%> </td>
										<td>&nbsp;</td>
										<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][i])%></td>
										<%{{'}'}}%>
									</tr>
									<tr>
										<td>= Ending Balance</td>
										<%for(i=0;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][i])%></td>
										<%{{'}'}}%>
									</tr>
								</tbody>
							</table>
						<%{{'}'}}else if(data_left['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
							<table>
								<thead>
									<th>&nbsp;</th>
									<th>Today</th>
									<th><%=future_months[0]%></th>
									<th>...</th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-2)%></th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-1)%></th>
									<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded'])%></th>
								</thead>
								<tbody>
									<tr>
										<td>Beginning Balance</td>
										<td>&nbsp;</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
									<tr>
										<td>- <%=data_left['survival_period']['deduction']%></td>
										<td>&nbsp;</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
									<tr>
										<td>= Ending Balance</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][0])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][1])%></td>
										<td>...</td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
										<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
									</tr>
								</tbody>
							</table>
						<%{{'}'}}%>					
						<div style="margin-left:56px;">
							<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
								This assumes:
							</p>
							<ul style="font-size:12px;">
								<li>You make only the minimum payments on your debt (if applicable)</li>
								<li>Your expenses remain as currently projected</li>
								<li>You don&apos;t borrow money</li>
								<li>All of your assets are liquid and usable to fund your expenses</li>
							</ul>
						</div>				
					<%}%>
				</div>
			
			<%{{'}'}}%>
		<%{{'}'}}else if(data_left['insolvent'] == true) {{'{'}}%>
			<div>
				<h4>Total Income: $<%=numberWithCommas(data_left['income']['total'][1])%></h4>
				<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_left['amount'])%></h4>
				<h4 style="border-top:1px solid gray;width:50%;color:#FF6666;">Net Income: $<%=numberWithCommas(data_left['net_income_raw'][1])%></h4>
			</div>
			<div id="expense_breakdown" style="margin-top:40px;">
				<table>
					<thead>
						<th>Expense Category</th>
						<th>Amount</th>
						<th>% of Total Income</th>
					</thead>
					<tbody>
						<%for(i=0;i<expenses_left.length;i++){{'{'}} %>
							<tr>
								<td><%=expenses_left[i]['name']%></td>
								<td>$<%=numberWithCommas(expenses_left[i]['amount'])%></td>
								<td><%=expenses_left[i]['pct']%>%</td>
							</tr>
						<% {{'}'}} %>
							<tr>
								<td class="table_y_axis">Total Expenses</td>
								<td><strong>$<%=numberWithCommas(expenses_totals_left['amount'])%></strong></td>
								<td><strong><%=expenses_totals_left['pct']%>%</strong></td>
							</tr>
							<tr style="color:#FF6666;">
								<td class="table_y_axis">Net Income</td>
								<td><strong>$<%=numberWithCommas(Math.round(data_left['net_income_raw'][1]))%></strong></td>
								<td><strong><%=Math.round((100.0 - expenses_totals_left['pct'])*10)/10%>%</strong></td>
							</tr>
					</tbody>
				</table>
			</div>
			<div id="survival_period" style="margin-top:40px;">
				<p style="font-size:16px;">
					<strong>You are projected to be insolvent in about <%=data_left['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
				</p>
				<%if(data_left['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
					<table>
						<thead>
							<th>&nbsp;</th>
							<th>Today</th>
							<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
								<th><%=month_conversion(i)%></th>
							<%{{'}'}}%>
						</thead>
						<tbody>
							<tr>
								<td>Beginning Balance</td>
								<td>&nbsp;</td>
								<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
									<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][i])%></td>
								<%{{'}'}}%>
							</tr>
							<tr>
								<td>- <%=data_left['survival_period']['deduction']%></td>
								<td>&nbsp;</td>
								<%for(i=1;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
									<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][i])%></td>
								<%{{'}'}}%>
							</tr>
							<tr>
								<td>= Ending Balance</td>
								<%for(i=0;i<=data_left['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
									<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][i])%></td>
								<%{{'}'}}%>
							</tr>
						</tbody>
					</table>
				<%{{'}'}}else if(data_left['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
					<table>
						<thead>
							<th>&nbsp;</th>
							<th>Today</th>
							<th><%=future_months[0]%></th>
							<th>...</th>
							<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-2)%></th>
							<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded']-1)%></th>
							<th><%=month_conversion(data_left['survival_period']['months_remaining_rounded'])%></th>
						</thead>
						<tbody>
							<tr>
								<td>Beginning Balance</td>
								<td>&nbsp;</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][1])%></td>
								<td>...</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['beginning_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
							</tr>
							<tr>
								<td>- <%=data_left['survival_period']['deduction']%></td>
								<td>&nbsp;</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][1])%></td>
								<td>...</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['expenses'][data_left['survival_period']['months_remaining_rounded']])%></td>
							</tr>
							<tr>
								<td>= Ending Balance</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][0])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][1])%></td>
								<td>...</td>
								<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-2])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']-1])%></td>
								<td>$<%=numberWithCommas(data_left['survival_period']['ending_balance'][data_left['survival_period']['months_remaining_rounded']])%></td>
							</tr>
						</tbody>
					</table>
				<%{{'}'}}%>					
				<div style="margin-left:56px;">
					<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
						This assumes:
					</p>
					<ul style="font-size:12px;">
						<li>You make only the minimum payments on your debt (if applicable)</li>
						<li>Your expenses remain as currently projected</li>
						<li>You don&apos;t borrow money</li>
						<li>All of your assets are liquid and usable to fund your expenses</li>
					</ul>
				</div>				
			</div>
			<div style="margin-top:40px;font-size:16px;">
				<p style="font-weight:bold">
					Some options to remedy the situation include:
				</p>
				<ul>
					<li>Reduce your expenses</li>
					<li>Increase your income</li>
					<li>Borrow money</li>
				</ul>
			</div>
		<%{{'}'}}%>
	</div>
	

	<div id="cashflow_right" class="right_case_container">
		<%if(data_right != false){{'{'}}%>
			<h3 class="case_name"><%=data_right['name']%></h3>
			<%if(data_right['insolvent'] == false){{'{'}} %>
				<%if(data_right['net_income'][1] >= 0){{'{'}}%>
					<div id="cashflow_right_pie" style="min-width: 470px; height:350px;"></div>
					<div style="position:relative;top:-20px;">
						<h4>Total Income: $<%=numberWithCommas(data_right['income']['total'][1])%></h4>
						<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_right['amount'])%></h4>
						<h4 style="border-top:1px solid gray;width:50%;">Net Income: <span style="color:#4DB870;">$<%=numberWithCommas(data_right['net_income_raw'][1])%></span></h4>
					</div>
					<div id="cashflow_net_income_usage" style="margin-top:40px;margin-bottom:40px;">
						<span style="font-weight:bold;font-size:14pt;text-decoration:underline;">You should use your positive net income to:</span>
						<br>
						<%for(i=0;i<data_right['NI_allocation'].length;i++){{'{'}}%>
							<%if(data_right['NI_allocation'][i]['type'] == 'debt_accounts'){{'{'}}%>
								<h5><%=i+1%>) Pay Down Your <%=data_right['NI_allocation'][i]['name']%> Debt</h5>
								<ul>
									<li>Pay $<%=numberWithCommas(data_right['NI_allocation'][i]['total_payment'])%> per month ($<%=numberWithCommas(data_right['NI_allocation'][i]['minimum_payment'])%> minimum + $<%=numberWithCommas(data_right['NI_allocation'][i]['extra_payment'])%> extra) starting in <%=month_conversion(data_right['NI_allocation'][i]['start_date'])%></li>
									<li>This debt will be paid off by <%=month_conversion(data_right['NI_allocation'][i]['payoff_date'])%> (see the Debt Summary section for details)</li>
								</ul>
							<%{{'}'}}else{{'{'}}%>
								<% if(data_right['NI_allocation'][i]['contribution'] > 0){{'{'}}%>
									<h5><%=i+1%>) Contribute to Your <%=data_right['NI_allocation'][i]['name']%> Account</h5>
									<ul>
										<li>Contribute $<%=numberWithCommas(data_right['NI_allocation'][i]['contribution'])%> per month starting in <%=month_conversion(data_right['NI_allocation'][i]['start_date'])%></li>
										<li>You can expect to have about $<%=numberWithCommas(roundToHundreds(data_right['NI_allocation'][i]['end_balance']))%> in the account 10 years from now (see the Assets Summary section for details)</li>
									</ul>
								<%{{'}'}}%>
							<%{{'}'}}%>
						<%{{'}'}}%>
					</div>
					<div class="case_section_divider"></div>
					<div id="survival_period" style="margin-top:20px;">	
						<%if(data_right['survival_period']['months_remaining'] == 'no expenses'){ %>
							No expenses entered yet
						<%}else if(data_right['survival_period']['months_remaining'] == '>10'){{'{'}}%>
							<p style="font-size:16px;">
								If your income suddenly went to zero, you could survive for <strong>more than 10 years</strong>.
							</p>
						<%}else{ %>

							<h4 style="margin:10px 0;">Survial Without Income</h4>
							<p style="font-size:16px;">
								If your income suddenly went to zero, you could survive for <strong>about <%=data_right['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
							</p>
							<%if(data_right['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
								<table>
									<thead>
										<th>&nbsp;</th>
										<th>Today</th>
										<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<th><%=month_conversion(i)%></th>
										<%{{'}'}}%>
									</thead>
									<tbody>
										<tr>
											<td>Beginning Balance</td>
											<td>&nbsp;</td>
											<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][i])%></td>
											<%{{'}'}}%>
										</tr>
										<tr>
											<td>- <%=data_right['survival_period']['deduction']%></td>
											<td>&nbsp;</td>
											<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][i])%></td>
											<%{{'}'}}%>
										</tr>
										<tr>
											<td>= Ending Balance</td>
											<%for(i=0;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][i])%></td>
											<%{{'}'}}%>
										</tr>
									</tbody>
								</table>
							<%{{'}'}}else if(data_right['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
								<table>
									<thead>
										<th>&nbsp;</th>
										<th>Today</th>
										<th><%=future_months[0]%></th>
										<th>...</th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-2)%></th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-1)%></th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded'])%></th>
									</thead>
									<tbody>
										<tr>
											<td>Beginning Balance</td>
											<td>&nbsp;</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
										<tr>
											<td>- <%=data_right['survival_period']['deduction']%></td>
											<td>&nbsp;</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
										<tr>
											<td>= Ending Balance</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][0])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
									</tbody>
								</table>
							<%{{'}'}}%>					
							<div style="margin-left:56px;">
								<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
									This assumes:
								</p>
								<ul style="font-size:12px;">
									<li>You make only the minimum payments on your debt (if applicable)</li>
									<li>Your expenses remain as currently projected</li>
									<li>You don&apos;t borrow money</li>
									<li>All of your assets are liquid and usable to fund your expenses</li>
								</ul>
							</div>				
						<%}%>
					</div>
				<%{{'}'}}else if(data['net_income'][1] < 0){{'{'}}%>
					<div>
						<h4>Total Income: $<%=numberWithCommas(data_right['income']['total'][1])%></h4>
						<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_right['amount'])%></h4>
						<h4 style="border-top:1px solid gray;width:50%;color:#FF6666;">Net Income: $<%=numberWithCommas(data_right['net_income_raw'][1])%></h4>
					</div>
					<div id="expense_breakdown" style="margin-top:40px;">
						<table>
							<thead>
								<th>Expense Category</th>
								<th>Amount</th>
								<th>% of Total Income</th>
							</thead>
							<tbody>
								<%for(i=0;i<expenses_right.length;i++){{'{'}} %>
									<tr>
										<td><%=expense_rights[i]['name']%></td>
										<td>$<%=numberWithCommas(expenses_right[i]['amount'])%></td>
										<td><%=expenses_right[i]['pct']%>%</td>
									</tr>
								<% {{'}'}} %>
									<tr>
										<td class="table_y_axis">Total Expenses</td>
										<td><strong>$<%=numberWithCommas(expenses_totals_right['amount'])%></strong></td>
										<td><strong><%=expenses_totals_right['pct']%>%</strong></td>
									</tr>
									<tr style="color:#FF6666;">
										<td class="table_y_axis">Net Income</td>
										<td><strong>$<%=numberWithCommas(Math.round(data_right['net_income_raw'][1]))%></strong></td>
										<td><strong><%=Math.round((100.0 - expenses_totals_right['pct'])*10)/10%>%</strong></td>
									</tr>
							</tbody>
						</table>
					</div>
					<div style="margin-top:40px;margin-bottom:40px;font-size:16px;">
						<p style="font-weight:bold">
							You are currently running a net income deficit, but you are not projected to have any near-term solvency issues.
						</p>
					</div>
					<div id="survival_period" style="margin-top:20px;">
						<%if(data_right['survival_period']['months_remaining'] == 'no expenses'){ %>
							No expenses entered yet
						<%}else if(data_right['survival_period']['months_remaining'] == '>10'){{'{'}}%>
							<p style="font-size:16px;">
								If your income suddenly went to zero, you could survive for <strong>more than 10 years</strong>.
							</p>
						<%}else{ %>
							<h4 style="margin:10px 0;">Survial Without Income</h4>
							<p style="font-size:16px;">
								If your income suddenly went to zero, you could survive for <strong>about <%=data_right['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
							</p>
							<%if(data_right['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
								<table>
									<thead>
										<th>&nbsp;</th>
										<th>Today</th>
										<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
											<th><%=month_conversion(i)%></th>
										<%{{'}'}}%>
									</thead>
									<tbody>
										<tr>
											<td>Beginning Balance</td>
											<td>&nbsp;</td>
											<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][i])%></td>
											<%{{'}'}}%>
										</tr>
										<tr>
											<td>- <%=data_right['survival_period']['deduction']%> </td>
											<td>&nbsp;</td>
											<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][i])%></td>
											<%{{'}'}}%>
										</tr>
										<tr>
											<td>= Ending Balance</td>
											<%for(i=0;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
												<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][i])%></td>
											<%{{'}'}}%>
										</tr>
									</tbody>
								</table>
							<%{{'}'}}else if(data_right['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
								<table>
									<thead>
										<th>&nbsp;</th>
										<th>Today</th>
										<th><%=future_months[0]%></th>
										<th>...</th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-2)%></th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-1)%></th>
										<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded'])%></th>
									</thead>
									<tbody>
										<tr>
											<td>Beginning Balance</td>
											<td>&nbsp;</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
										<tr>
											<td>- <%=data_right['survival_period']['deduction']%></td>
											<td>&nbsp;</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
										<tr>
											<td>= Ending Balance</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][0])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][1])%></td>
											<td>...</td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
											<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
										</tr>
									</tbody>
								</table>
							<%{{'}'}}%>					
							<div style="margin-left:56px;">
								<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
									This assumes:
								</p>
								<ul style="font-size:12px;">
									<li>You make only the minimum payments on your debt (if applicable)</li>
									<li>Your expenses remain as currently projected</li>
									<li>You don&apos;t borrow money</li>
									<li>All of your assets are liquid and usable to fund your expenses</li>
								</ul>
							</div>				
						<%}%>
					</div>
				
				<%{{'}'}}%>
			<%{{'}'}}else if(data_right['insolvent'] == true) {{'{'}}%>
				<div>
					<h4>Total Income: $<%=numberWithCommas(data_right['income']['total'][1])%></h4>
					<h4>Total Expenses: $<%=numberWithCommas(expenses_totals_right['amount'])%></h4>
					<h4 style="border-top:1px solid gray;width:50%;color:#FF6666;">Net Income: $<%=numberWithCommas(data_right['net_income_raw'][1])%></h4>
				</div>
				<div id="expense_breakdown" style="margin-top:40px;">
					<table>
						<thead>
							<th>Expense Category</th>
							<th>Amount</th>
							<th>% of Total Income</th>
						</thead>
						<tbody>
							<%for(i=0;i<expenses_right.length;i++){{'{'}} %>
								<tr>
									<td><%=expenses_right[i]['name']%></td>
									<td>$<%=numberWithCommas(expenses_right[i]['amount'])%></td>
									<td><%=expenses_right[i]['pct']%>%</td>
								</tr>
							<% {{'}'}} %>
								<tr>
									<td class="table_y_axis">Total Expenses</td>
									<td><strong>$<%=numberWithCommas(expenses_totals_right['amount'])%></strong></td>
									<td><strong><%=expenses_totals_right['pct']%>%</strong></td>
								</tr>
								<tr style="color:#FF6666;">
									<td class="table_y_axis">Net Income</td>
									<td><strong>$<%=numberWithCommas(Math.round(data_right['net_income_raw'][1]))%></strong></td>
									<td><strong><%=Math.round((100.0 - expenses_totals_right['pct'])*10)/10%>%</strong></td>
								</tr>
						</tbody>
					</table>
				</div>
				<div id="survival_period" style="margin-top:40px;">
					<p style="font-size:16px;">
						<strong>You are projected to be insolvent in about <%=data_right['survival_period']['months_remaining'].toFixed(1)%> months</strong>.
					</p>
					<%if(data_right['survival_period']['months_remaining_rounded'] < 6){{'{'}} %>
						<table>
							<thead>
								<th>&nbsp;</th>
								<th>Today</th>
								<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
									<th><%=month_conversion(i)%></th>
								<%{{'}'}}%>
							</thead>
							<tbody>
								<tr>
									<td>Beginning Balance</td>
									<td>&nbsp;</td>
									<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
										<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][i])%></td>
									<%{{'}'}}%>
								</tr>
								<tr>
									<td>- <%=data_right['survival_period']['deduction']%></td>
									<td>&nbsp;</td>
									<%for(i=1;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
										<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][i])%></td>
									<%{{'}'}}%>
								</tr>
								<tr>
									<td>= Ending Balance</td>
									<%for(i=0;i<=data_right['survival_period']['months_remaining_rounded'];i++){{'{'}}%>
										<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][i])%></td>
									<%{{'}'}}%>
								</tr>
							</tbody>
						</table>
					<%{{'}'}}else if(data_right['survival_period']['months_remaining_rounded'] >= 6){{'{'}}%>
						<table>
							<thead>
								<th>&nbsp;</th>
								<th>Today</th>
								<th><%=future_months[0]%></th>
								<th>...</th>
								<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-2)%></th>
								<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded']-1)%></th>
								<th><%=month_conversion(data_right['survival_period']['months_remaining_rounded'])%></th>
							</thead>
							<tbody>
								<tr>
									<td>Beginning Balance</td>
									<td>&nbsp;</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][1])%></td>
									<td>...</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['beginning_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
								</tr>
								<tr>
									<td>- <%=data_right['survival_period']['deduction']%></td>
									<td>&nbsp;</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][1])%></td>
									<td>...</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['expenses'][data_right['survival_period']['months_remaining_rounded']])%></td>
								</tr>
								<tr>
									<td>= Ending Balance</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][0])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][1])%></td>
									<td>...</td>
									<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-2])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']-1])%></td>
									<td>$<%=numberWithCommas(data_right['survival_period']['ending_balance'][data_right['survival_period']['months_remaining_rounded']])%></td>
								</tr>
							</tbody>
						</table>
					<%{{'}'}}%>					
					<div style="margin-left:56px;">
						<p style="font-size:12px; margin-top:20px; margin-bottom:0;">
							This assumes:
						</p>
						<ul style="font-size:12px;">
							<li>You make only the minimum payments on your debt (if applicable)</li>
							<li>Your expenses remain as currently projected</li>
							<li>You don&apos;t borrow money</li>
							<li>All of your assets are liquid and usable to fund your expenses</li>
						</ul>
					</div>				
				</div>
				<div style="margin-top:40px;font-size:16px;">
					<p style="font-weight:bold">
						Some options to remedy the situation include:
					</p>
					<ul>
						<li>Reduce your expenses</li>
						<li>Increase your income</li>
						<li>Borrow money</li>
					</ul>
				</div>
			<%{{'}'}}%>
		<%{{'}'}}else{{'{'}}%>
			<h3 class="case_name">[No Active Case]</h3>			
		<%{{'}'}}%>
	</div>	
</script>

<script type="text/template" id="debt_summary_template">
	<div class="left_case_container">
		<h3 class="case_name">Base Case</h3>
		<%if(data_left['debt_accounts']['no_debt']==true){{'{'}}%>
			<p>
				You have no debt.
			</p>
		<%{{'}'}}else{{'{'}}%>
			<div id="debt_summary_table1">
				<table>
					<thead>
						<th style="text-align:left;">Account</th>
						<th>Current Balance</th>
						<th>Current Minimum Payment</th>
						<th>Interest Rate</th>
					</thead>
					<tbody>
						<% _.each(_.keys(data_left['debt_accounts']['accounts']), function(key){{'{'}} %>
							<%if(data_left['debt_accounts']['accounts'][key]['items']['ending_balance'][0] > 0 ){{'{'}}%>
								<tr>
									<td class="table_y_axis"><%=key%></td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['items']['ending_balance'][0])%></td>
									<td>$<%=numberWithCommas(-1*data_left['debt_accounts']['accounts'][key]['items']['payments'][1])%></td>
									<td><%=(Math.round(data_left['debt_accounts']['accounts'][key]['rate'] * 1000)/10).toFixed(1)%>%</td>
								</tr>
							<%{{'}'}}%>
						<%{{'});'}}%>
						<%if(_.keys(debt_accounts_left).length >=2){{'{'}}%>
							<tr>
								<td class="table_y_axis">Total</td>
								<td>$<%=numberWithCommas(data_left['debt_accounts']['total_debt'][0])%></td>
								<td>$<%=numberWithCommas(-1*debt_totals_left['min_payment'])%></td>
								<td><%=(Math.round(debt_totals_left['WA_rate'] * 1000)/10).toFixed(1)%>%</td>
							</tr>
						<%{{'}'}}%>
					</tbody>
				</table>
			</div>
			
			<%if(data_left['insolvent'] == false) {{'{'}}%>
				<div id="debt_chart" style="text-align:center;margin-top:40px;">
					<div><h4>Projected Debt Balances over Time</h4></div>
					<div id="debt_chart_left_div" style="width:470px;"></div>
					
				</div>
				<div id="debt_summary_table2" style="margin:40px 0">
					<table>
						<thead>
							<th style="text-align:left;">Account</th>
							<th>Expected Payoff Date</th>
							<th>Interest To Be Paid</th>
							<th>Principal To Be Paid</th>
							<th>Total To Be Paid</th>
						</thead>
						<tbody>
							<% _.each(_.keys(data_left['debt_accounts']['accounts']), function(key){{'{'}} %>
								<tr>
									<td class="table_y_axis"><%=key%></td>
									<td>
										<%=month_conversion(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'])%> 
										<br>
										(<%=data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date']%> months)
									</td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'])%></td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'])%></td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'])%></td>
								</tr>
							<%{{'});'}}%>
							<%if(_.keys(data_left['debt_accounts']['accounts']).length >=2){{'{'}}%>
								<tr>
									<td class="table_y_axis">Total</td>
									<td>
									<%=month_conversion(data_left['debt_accounts']['debt_expense_summary']['payoff_date'])%> 
									<br>
									(<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['payoff_date'])%> months)
									</td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_interest_paid'])%></td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_principal_paid'])%></td>
									<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_debt_expense'])%></td>
								</tr>
							<%{{'}'}}%>
						</tbody>
					</table>
				</div>

			
				<h4 class="case_name">Extra Payments vs. Minimum Payments Only</h4>
				<% _.each(_.keys(data_left['debt_accounts']['accounts']), function(key){{'{'}} %>
					<div style="margin-top:40px;">
					<h4><%=key%></h4>
						<table>
							<thead>
								<th style="text-align:left;">&nbsp;</th>
								<th>Expected Payoff Date</th>
								<th>Interest To Be Paid</th>
								<th>Principal To Be Paid</th>
								<th>Total To Be Paid</th>
							</thead>
							<tbody>
									<tr>
										<td class="table_y_axis">Extra Payments</td>
										<td>
											<%=month_conversion(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'])%>
											<br>
											 (<%=data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date']%> months)
										</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'])%></td>
									</tr>
									<tr>
										<td class="table_y_axis">Minimum Payments Only</td>
										<td>
											<%=month_conversion(data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date'])%>
											<br>
											 (<%=data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date']%> months)
										</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_debt_expense'])%></td>
									</tr>
									<tr>
										<td class="table_y_axis">Difference</td>
										<td><%=data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'] - data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date']%> months</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'] - data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'] - data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'] - data_left['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_debt_expense'])%></td>
									</tr>
							</tbody>
						</table>
					</div>
				<%{{'});'}}%>
				<%if(_.keys(data_left['debt_accounts']['accounts']).length >=2){{'{'}}%>
					<div style="margin-top:40px;">
						<h4>All Debt</h4>
						<table>
							<thead>
								<th style="text-align:left;">&nbsp;</th>
								<th>Expected Payoff Date</th>
								<th>Interest To Be Paid</th>
								<th>Principal To Be Paid</th>
								<th>Total To Be Paid</th>
							</thead>
							<tbody>
									<tr>
										<td class="table_y_axis">Extra Payments</td>
										<td>
											<%=month_conversion(data_left['debt_accounts']['debt_expense_summary']['payoff_date'])%>
											<br>
											 (<%=data_left['debt_accounts']['debt_expense_summary']['payoff_date']%> months)
										</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_debt_expense'])%></td>
									</tr>
									<tr>
										<td class="table_y_axis">Minimum Payments Only</td>
										<td>
											<%=month_conversion(data_left['debt_accounts']['debt_expense_summary_min']['payoff_date'])%>
											<br>
											 (<%=data_left['debt_accounts']['debt_expense_summary_min']['payoff_date']%> months)
										</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary_min']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary_min']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary_min']['total_debt_expense'])%></td>
									</tr>
									<tr>
										<td class="table_y_axis">Difference</td>
										<td><%=data_left['debt_accounts']['debt_expense_summary']['payoff_date'] - data_left['debt_accounts']['debt_expense_summary_min']['payoff_date']%> months</td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_interest_paid'] - data_left['debt_accounts']['debt_expense_summary_min']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_principal_paid'] - data_left['debt_accounts']['debt_expense_summary_min']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_left['debt_accounts']['debt_expense_summary']['total_debt_expense'] - data_left['debt_accounts']['debt_expense_summary_min']['total_debt_expense'])%></td>
									</tr>
							</tbody>
						</table>
					</div>
				<%{{'}'}}%>
			<%{{'}'}}else{{'{'}}%>
				<p style="margin-top:40px;font-size:16px;">
					<strong>You are projected to be insolvent. For projections about your debt to be meaningful, you must first resolve your cash flow problem.</strong>
				</p>
			<%{{'}'}}%>
		<%{{'}'}}%>
	</div>
	<div class="right_case_container">
		<%if(data_right!=false){{'{'}}%>
			<h3 class="case_name"><%=data_right['name']%></h3>
			<%if(data_right['debt_accounts']['no_debt']==true){{'{'}}%>
				<p>
					You have no debt.
				</p>
			<%{{'}'}}else{{'{'}}%>
				<div id="debt_summary_table1">
					<table>
						<thead>
							<th style="text-align:left;">Account</th>
							<th>Current Balance</th>
							<th>Current Minimum Payment</th>
							<th>Interest Rate</th>
						</thead>
						<tbody>
							<% _.each(_.keys(data_right['debt_accounts']['accounts']), function(key){{'{'}} %>
								<%if(data_right['debt_accounts']['accounts'][key]['items']['ending_balance'][0] > 0 ){{'{'}}%>
									<tr>
										<td class="table_y_axis"><%=key%></td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['items']['ending_balance'][0])%></td>
										<td>$<%=numberWithCommas(-1*data_right['debt_accounts']['accounts'][key]['items']['payments'][1])%></td>
										<td><%=(Math.round(data_right['debt_accounts']['accounts'][key]['rate'] * 1000)/10).toFixed(1)%>%</td>
									</tr>
								<%{{'}'}}%>
							<%{{'});'}}%>
							<%if(_.keys(debt_accounts_right).length >=2){{'{'}}%>
								<tr>
									<td class="table_y_axis">Total</td>
									<td>$<%=numberWithCommas(data_right['debt_accounts']['total_debt'][0])%></td>
									<td>$<%=numberWithCommas(-1*debt_totals_right['min_payment'])%></td>
									<td><%=(Math.round(debt_totals_right['WA_rate'] * 1000)/10).toFixed(1)%>%</td>
								</tr>
							<%{{'}'}}%>
						</tbody>
					</table>
				</div>
				
				<%if(data_right['insolvent'] == false) {{'{'}}%>
					<div id="debt_chart" style="text-align:center;margin-top:40px;">
						<div><h4>Projected Debt Balances over Time</h4></div>
						<div id="debt_chart_right_div" style="width:470px;"></div>
						
					</div>
					<div id="debt_summary_table2" style="margin:40px 0">
						<table>
							<thead>
								<th style="text-align:left;">Account</th>
								<th>Expected Payoff Date</th>
								<th>Interest To Be Paid</th>
								<th>Principal To Be Paid</th>
								<th>Total To Be Paid</th>
							</thead>
							<tbody>
								<% _.each(_.keys(data_right['debt_accounts']['accounts']), function(key){{'{'}} %>
									<tr>
										<td class="table_y_axis"><%=key%></td>
										<td>
											<%=month_conversion(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'])%> 
											<br>
											(<%=data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date']%> months)
										</td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'])%></td>
									</tr>
								<%{{'});'}}%>
								<%if(_.keys(data_right['debt_accounts']['accounts']).length >=2){{'{'}}%>
									<tr>
										<td class="table_y_axis">Total</td>
										<td>
										<%=month_conversion(data_right['debt_accounts']['debt_expense_summary']['payoff_date'])%> 
										<br>
										(<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['payoff_date'])%> months)
										</td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_interest_paid'])%></td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_principal_paid'])%></td>
										<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_debt_expense'])%></td>
									</tr>
								<%{{'}'}}%>
							</tbody>
						</table>
					</div>

				
					<h4 class="case_name">Extra Payments vs. Minimum Payments Only</h4>
					<% _.each(_.keys(data_right['debt_accounts']['accounts']), function(key){{'{'}} %>
						<div style="margin-top:40px;">
						<h4><%=key%></h4>
							<table>
								<thead>
									<th style="text-align:left;">&nbsp;</th>
									<th>Expected Payoff Date</th>
									<th>Interest To Be Paid</th>
									<th>Principal To Be Paid</th>
									<th>Total To Be Paid</th>
								</thead>
								<tbody>
										<tr>
											<td class="table_y_axis">Extra Payments</td>
											<td>
												<%=month_conversion(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'])%>
												<br>
												 (<%=data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date']%> months)
											</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'])%></td>
										</tr>
										<tr>
											<td class="table_y_axis">Minimum Payments Only</td>
											<td>
												<%=month_conversion(data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date'])%>
												<br>
												 (<%=data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date']%> months)
											</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_debt_expense'])%></td>
										</tr>
										<tr>
											<td class="table_y_axis">Difference</td>
											<td><%=data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['payoff_date'] - data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['payoff_date']%> months</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_interest_paid'] - data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_principal_paid'] - data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['accounts'][key]['debt_expense_summary']['total_debt_expense'] - data_right['debt_accounts']['accounts'][key]['debt_expense_summary_min']['total_debt_expense'])%></td>
										</tr>
								</tbody>
							</table>
						</div>
					<%{{'});'}}%>
					<%if(_.keys(data_right['debt_accounts']['accounts']).length >=2){{'{'}}%>
						<div style="margin-top:40px;">
							<h4>All Debt</h4>
							<table>
								<thead>
									<th style="text-align:left;">&nbsp;</th>
									<th>Expected Payoff Date</th>
									<th>Interest To Be Paid</th>
									<th>Principal To Be Paid</th>
									<th>Total To Be Paid</th>
								</thead>
								<tbody>
										<tr>
											<td class="table_y_axis">Extra Payments</td>
											<td>
												<%=month_conversion(data_right['debt_accounts']['debt_expense_summary']['payoff_date'])%>
												<br>
												 (<%=data_right['debt_accounts']['debt_expense_summary']['payoff_date']%> months)
											</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_debt_expense'])%></td>
										</tr>
										<tr>
											<td class="table_y_axis">Minimum Payments Only</td>
											<td>
												<%=month_conversion(data_right['debt_accounts']['debt_expense_summary_min']['payoff_date'])%>
												<br>
												 (<%=data_right['debt_accounts']['debt_expense_summary_min']['payoff_date']%> months)
											</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary_min']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary_min']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary_min']['total_debt_expense'])%></td>
										</tr>
										<tr>
											<td class="table_y_axis">Difference</td>
											<td><%=data_right['debt_accounts']['debt_expense_summary']['payoff_date'] - data_right['debt_accounts']['debt_expense_summary_min']['payoff_date']%> months</td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_interest_paid'] - data_right['debt_accounts']['debt_expense_summary_min']['total_interest_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_principal_paid'] - data_right['debt_accounts']['debt_expense_summary_min']['total_principal_paid'])%></td>
											<td>$<%=numberWithCommas(data_right['debt_accounts']['debt_expense_summary']['total_debt_expense'] - data_right['debt_accounts']['debt_expense_summary_min']['total_debt_expense'])%></td>
										</tr>
								</tbody>
							</table>
						</div>
					<%{{'}'}}%>
				<%{{'}'}}else{{'{'}}%>
					<p style="margin-top:40px;font-size:16px;">
						<strong>You are projected to be insolvent. For projections about your debt to be meaningful, you must first resolve your cash flow problem.</strong>
					</p>
				<%{{'}'}}%>
			<%{{'}'}}%>
		<%{{'}'}}else{{'{'}}%>
			<h3 class="case_name">[No Active Case]</h3>
		<%{{'}'}}%>
	</div>
</script>

<script type="text/template" id="asset_summary_template">
	<div class="left_case_container">
		<h3 class="case_name"><%=data_left['name']%></h3>
		<div id="asset_summary_table1">
			<table>
				<thead>
					<th style="text-align:left;">Account</th>
					<th>Current Balance</th>
					<th>Expected Return</th>
				</thead>
				<tbody>
					<% _.each(_.keys(data_left['cash_accounts']['accounts']), function(key){{'{'}} %>
						<%if(data_left['cash_accounts']['accounts'][key]['items']['ending_balance'][0] > 0 ){{'{'}}%>
							<tr>
								<td class="table_y_axis"><%=key%></td>
								<td>$<%=numberWithCommas(data_left['cash_accounts']['accounts'][key]['items']['ending_balance'][0])%></td>
								<td><%=(Math.round(data_left['cash_accounts']['accounts'][key]['rate'] * 1000)/10).toFixed(1)%>%</td>
							</tr>
						<%{{'}'}}%>
					<%{{'});'}}%>
					<%if(_.keys(cash_accounts_left).length >=2){{'{'}}%>
						<tr>
							<td class="table_y_axis">Total</td>
							<td>$<%=numberWithCommas(data_left['cash_accounts']['total'][0])%></td>
							<td><%=(Math.round(WA_rate_left * 1000)/10).toFixed(1)%>%</td>
						</tr>
					<%{{'}'}}%>
				</tbody>
			</table>
		</div>
		<div id="asset_chart" style="text-align:center;margin-top:40px;">
			<div><h4>Projected Asset Balances over Time</h4></div>
			<div id="asset_chart_left_div" style="width:470px;"></div>
		</div>
	</div>
	<div class="right_case_container">
		<%if(data_right!=false){{'{'}}%>
			<h3 class="case_name"><%=data_right['name']%></h3>
			<div id="asset_summary_table1">
				<table>
					<thead>
						<th style="text-align:left;">Account</th>
						<th>Current Balance</th>
						<th>Expected Return</th>
					</thead>
					<tbody>
						<% _.each(_.keys(data_right['cash_accounts']['accounts']), function(key){{'{'}} %>
							<%if(data_right['cash_accounts']['accounts'][key]['items']['ending_balance'][0] > 0 ){{'{'}}%>
								<tr>
									<td class="table_y_axis"><%=key%></td>
									<td>$<%=numberWithCommas(data_right['cash_accounts']['accounts'][key]['items']['ending_balance'][0])%></td>
									<td><%=(Math.round(data_right['cash_accounts']['accounts'][key]['rate'] * 1000)/10).toFixed(1)%>%</td>
								</tr>
							<%{{'}'}}%>
						<%{{'});'}}%>
						<%if(_.keys(cash_accounts_right).length >=2){{'{'}}%>
							<tr>
								<td class="table_y_axis">Total</td>
								<td>$<%=numberWithCommas(data_right['cash_accounts']['total'][0])%></td>
								<td><%=(Math.round(WA_rate_right * 1000)/10).toFixed(1)%>%</td>
							</tr>
						<%{{'}'}}%>
					</tbody>
				</table>
			</div>
			<div id="asset_chart" style="text-align:center;margin-top:40px;">
				<div><h4>Projected Asset Balances over Time</h4></div>
				<div id="asset_chart_right_div" style="width:470px;"></div>
			</div>
		<%{{'}'}}else{{'{'}}%>
			<h3 class="case_name">[No Active Case]</h3>
		<%{{'}'}}%>
	</div>
</script>

<script type="text/template" id="cases_template">
	<%_.each(cases,function(this_case){{'{'}} %>
		<%if(this_case['name'] != 'Base Case'){{'{'}} %>
			<a class="btn btn-danger delete_scenario" data-id="<%=this_case['id']%>">Delete Case</a>
		<%{{'}'}}%>
		<%=this_case['name'] %>
		<br>
	<%{{'})'}}%>
	
	<a id="new_scenario" class="btn btn-info">Create New Case</a>
</script>

<script type="text/template" id="active_case_template">
	<select id="active_case">
		<%_.each(cases,function(this_case){{'{'}}%>
			<option name="<%=this_case['name']%>"><%=this_case['name']%></option>	
		<%{{'})'}}%>
	</select>
</script>


<!-- VIEWS -->
<script type="text/javascript">
var ParentView = Backbone.View.extend({
	initialize: function(){
		self = this;
		{% if data_exists %}
			var this_model = new Case({id:{{base_id}} });
			this_model.fetch({
				success: function(){
					self.model.add(this_model); //add the new model to the collection
					self.render();

					var inputIncomeView = new InputIncomeView({el:$("#income_el"), model: self.model});
					var inputExpensesView = new InputExpensesView({el:$("#expenses_el"), model: self.model});
					var inputAssetsView = new InputAssetsView({el:$("#assets_el"), model: self.model});
					var inputDebtView = new InputDebtView({el:$("#debt_el"), model: self.model});

					var inputRightView = new InputRightView({el:$("#input_right"), model: self.model});

					var netWorthChartView = new NetWorthChartView({el:$('#net_worth_chart_legend'), model: self.model});
					var netWorthTablesView = new NetWorthTablesView({el:$('#net_worth_tables'), model: self.model});
					var cashflowview = new CashflowView({el:$('#cashflow_section'), model: self.model});
					var debtSummaryView = new DebtSummaryView({el:$('#debt_summary_section'),model: self.model});
					var assetSummaryView = new AssetSummaryView({el:$('#asset_summary_section'),model: self.model});

					var casesView = new CasesView({el:$('#cases_div'),model: self.model});
					var activeCaseView = new ActiveCaseView({el:$('#active_case_div'),model: self.model});
				}
			});
		{% else %}
    		var this_model = new Case();
    		this_model.set('data',{{new_data|safe}});
    		this_model.set('isBaseCase',true);
    		self.model.add(this_model); //add the new model to the collection
			self.render();

			var inputIncomeView = new InputIncomeView({el:$("#income_el"), model: self.model});
			var inputExpensesView = new InputExpensesView({el:$("#expenses_el"), model: self.model});
			var inputAssetsView = new InputAssetsView({el:$("#assets_el"), model: self.model});
			var inputDebtView = new InputDebtView({el:$("#debt_el"), model: self.model});

			var inputRightView = new InputRightView({el:$("#input_right"), model: self.model});

			var netWorthChartView = new NetWorthChartView({el:$('#net_worth_chart_legend'), model: self.model});
			var netWorthTablesView = new NetWorthTablesView({el:$('#net_worth_tables'), model: self.model});
			var cashflowview = new CashflowView({el:$('#cashflow_section'), model: self.model});
			var debtSummaryView = new DebtSummaryView({el:$('#debt_summary_section'),model: self.model});
			var assetSummaryView = new AssetSummaryView({el:$('#asset_summary_section'),model: self.model});

			var casesView = new CasesView({el:$('#cases_div'),model: self.model});
			var activeCaseView = new ActiveCaseView({el:$('#active_case_div'),model: self.model});
    	{% endif %}
    },
    render: function(){
    	var template = _.template( $("#input_base_template").html() );
    	this.$el.html( template );
    },
    events: {
        "click #save_input_data": "save_input_data",
    },
    save_input_data: function(callback){
    	this.model.each(function(model){
    		var cid = model.cid;

			$income_items = {};
			$basic_expenses = {};
			$misc_expenses = {};
			$cash_accounts = {};
			$debt_accounts = {};
			
			$input = $('.input_sub_'+cid);

			$input.each(function(){
				$input_type = $(this).attr('data-input-type');
				$section = $(this).attr('data-section');
				$name = $(this).attr('data-name');
				
				if($section == 'income_items' || $section == 'basic_expenses'){
					if($input_type == 'flatline'){
						$value = $(this).children('input').val();
						if($value == '') {$value = 0;}else{parseFloat($value.replace(/,/g, ''));}
						if(isNaN($value)){
							alert("\""+$name+"\" input must be a number");
							throw "\""+$name+"\" input must be a number";
						}
						else if($value < 0){
							alert("\""+$name+"\" input cannot be negative");
							throw "\""+$name+"\" input cannot be negative";
						}
						
						$frequency = $(this).children('select').val();
						if($section == 'income_items'){
							$income_items[$name] = {'type':$input_type,'frequency':$frequency,'value':$value};	
						} else {
							$basic_expenses[$name] = {'type':$input_type,'frequency':$frequency,'value':$value};
						}
					}else if($input_type == 'pct_change' || $input_type == 'val_change'){
						$value = $(this).children('input[name="value"]').val();
						if($value == '') {$value = 0;}else{parseFloat($value.replace(/,/g, ''));}
						if(isNaN($value)){
							alert("\""+$name+"\" input must be a number");
							throw "\""+$name+"\" input must be a number";
						}
						else if($value < 0){
							alert("\""+$name+"\" input cannot be negative");
							throw "\""+$name+"\" input cannot be negative";
						}

						$frequency = $(this).children('select[name="frequency"]').val();
						$change = $(this).children('input[name="change"]').val();
						if($change == '') {$change = 0;}else{parseFloat($change.replace(/,/g, ''));}
						if(isNaN($change)){
							alert("\""+$name+"\" input must be a number");
							throw "\""+$name+"\" input must be a number";
						}
						else if($change < 0){
							alert("\""+$name+"\" input cannot be negative");
							throw "\""+$name+"\" input cannot be negative";
						}

						$change_direction = $(this).children('select[name="change_direction"]').val();
						$change_frequency = $(this).children('select[name="change_frequency"]').val();
						$change_periods = $(this).children('input[name="change_periods"]').val();
						if($change_periods == '') {$change_periods = 0;}else{parseFloat($change_periods.replace(/,/g, ''));}
						if(isNaN($change_periods)){
							alert("\""+$name+"\" input must be a number");
							throw "\""+$name+"\" input must be a number";
						}
						else if($change_periods < 0){
							alert("\""+$name+"\" input cannot be negative");
							throw "\""+$name+"\" input cannot be negative";
						}

						if($section == 'income_items'){
							$income_items[$name] = {'type':$input_type,'frequency':$frequency,'change':$change,'change_frequency':$change_frequency,'change_direction':$change_direction,'change_periods':$change_periods, 'value':$value};	
						} else {
							$basic_expenses[$name] = {'type':$input_type,'frequency':$frequency,'change':$change,'change_frequency':$change_frequency,'change_direction':$change_direction,'change_periods':$change_periods, 'value':$value};
						}
					}else if($input_type == 'custom'){
						$periods = $(this).children('.custom_input_block');
						$data = [];
						$periods.each(function(){
							$value = $(this).children('input[name="value"]').val();
							if($value == '') {$value = 0;}else{parseFloat($value.replace(/,/g, ''));}
							if(isNaN($value)){
								alert("\""+$name+"\" input must be a number");
								throw "\""+$name+"\" input must be a number";
							}
							else if($value < 0){
								alert("\""+$name+"\" input cannot be negative");
								throw "\""+$name+"\" input cannot be negative";
							}

							$frequency = $(this).children('select[name="frequency"]').val();
							$start_mo = $(this).children('select[name="start_mo"]').val();
							$start_yr = $(this).children('select[name="start_yr"]').val();
							$end_mo = $(this).children('select[name="end_mo"]').val();
							$end_yr = $(this).children('select[name="end_yr"]').val();
							$data.push({'value':$value,'frequency':$frequency,'start_mo':$start_mo,'start_yr':$start_yr,'end_mo':$end_mo,'end_yr':$end_yr});
						});
						if($section == 'income_items'){
							$income_items[$name] = {'type':$input_type,data:$data};
						} else {
							$basic_expenses[$name] = {'type':$input_type,data:$data};
						}
					}
				} else if($section == 'cash_accounts'){
					$balance = $(this).children('span').children('input[name="balance"]').val();
					if($balance == '') {$balance = 0;}else{parseFloat($balance.replace(/,/g, ''));}
					if(isNaN($balance)){
						alert("\""+$name+"\" input must be a number");
						throw "\""+$name+"\" input must be a number";
					}
					else if($balance < 0){
						alert("\""+$name+"\" input cannot be negative");
						throw "\""+$name+"\" input cannot be negative";
					}

					$rate = $(this).children('span').children('input[name="rate"]').val();
					if($rate == '') {$rate = 0;}else{parseFloat($rate.replace(/,/g, ''));}
					if(isNaN($rate)){
						alert("\""+$name+"\" input must be a number");
						throw "\""+$name+"\" input must be a number";
					}
					else if($rate < 0){
						alert("\""+$name+"\" input cannot be negative");
						throw "\""+$name+"\" input cannot be negative";
					}

					$cash_accounts[$name] = {'balance':$balance,'rate':$rate};
				} else if($section == 'debt_accounts'){
					$payment = $(this).children('span').children('input[name="payment"]').val();
					if($payment == '') {$payment = 0;}else{parseFloat($payment.replace(/,/g, ''));}
					if(isNaN($payment)){
						alert("\""+$name+"\" input must be a number");
						throw "\""+$name+"\" input must be a number";
					}
					else if($payment < 0){
						alert("\""+$name+"\" input cannot be negative");
						throw "\""+$name+"\" input cannot be negative";
					}

					$balance = $(this).children('span').children('input[name="balance"]').val();
					if($balance == '') {$balance = 0;}else{parseFloat($balance.replace(/,/g, ''));}
					if(isNaN($balance)){
						alert("\""+$name+"\" input must be a number");
						throw "\""+$name+"\" input must be a number";
					}
					else if($balance < 0){
						alert("\""+$name+"\" input cannot be negative");
						throw "\""+$name+"\" input cannot be negative";
					}

					$rate = $(this).children('span').children('input[name="rate"]').val();
					if($rate == '') {$rate = 0;}else{parseFloat($rate.replace(/,/g, ''));}
					if(isNaN($rate)){
						alert("\""+$name+"\" input must be a number");
						throw "\""+$name+"\" input must be a number";
					}
					else if($rate < 0){
						alert("\""+$name+"\" input cannot be negative");
						throw "\""+$name+"\" input cannot be negative";
					}

					$debt_accounts[$name] = {'balance':$balance,'rate':$rate,'payment':$payment};
				}
			});
			console.log($income_items);
			console.log($basic_expenses);
			console.log($misc_expenses);
			console.log($debt_accounts);
			console.log($cash_accounts);
			
		    model.save({
		    	income_items: $income_items,
		    	basic_expenses: $basic_expenses,
		    	misc_expenses: $misc_expenses,
		    	debt_accounts: $debt_accounts,
		    	cash_accounts: $cash_accounts
	    	},
	    	{
	    		//wait:true,
	        	success: function(model){
	        		console.log('success');
	        		if ($.type(callback) == 'function'){
						console.log('callback');
				    	callback();
				    }
	        	},
				error: function(){
				    console.log('error');
				}
	        });
	        
		});

    return false;
	}
});

var CasesView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
	render: function(){
		var cases = [];

		this.model.each(function(model){
			cases.push({'name':model.get('name'),'id':model.cid});
		});
			
		//});
		var template = _.template( $("#cases_template").html(), {model:this.model.at(0), cases:cases} );
    	this.$el.html( template );
	}
});

var InputIncomeView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('income_items');
    	var template = _.template( $("#income_input_template").html(), {model:this.model.at(0), items:items} );
    	this.$el.html( template );
    }
});
var InputExpensesView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('basic_expenses');
    	var template = _.template( $("#expenses_input_template").html(), {model:this.model.at(0), items:items} );
    	this.$el.html( template );
    }
});
var InputAssetsView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('cash_accounts');
    	var template = _.template( $("#assets_input_template").html(), {model:this.model.at(0), items:items} );
    	this.$el.html( template );
    }
});
var InputDebtView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var items = this.model.at(0).get('debt_accounts');
    	var template = _.template( $("#debt_input_template").html(), {model:this.model.at(0), items:items} );
    	this.$el.html( template );
    }
});

var InputRightView = Backbone.View.extend({
	initialize: function(){
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
    render: function(){
    	var data = this.model.at(0).get('data');
    	//console.log(data);
    	if(data == null){
    		//console.log('yep');
    		data = {'net_income':{},'net_worth':{}};
    		data['net_income'][1] = 0;
    		data['net_worth'][1] = 0;
    		data['net_worth'][12] = 0;
    		data['net_worth'][60] = 0;
    	}
    	var template = _.template( $("#input_right_template").html(), {data:data} );
    	this.$el.html( template );
    }
});

var NetWorthTablesView = Backbone.View.extend({
	initialize: function(){
		_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
        this.render();
	},
	render: function(){
		var model_right = getActiveModel(this.model);
		if(model_right!=false){
			var model_right_data = model_right.get('data');
		}else{
			var model_right_data = false;
		}
		var template = _.template( $("#net_worth_tables_template").html(), {model_left_data:this.model.at(0).get('data'),model_right_data:model_right_data} );
        this.$el.html( template );
	}
});
var NetWorthChartView = Backbone.View.extend({
	initialize: function(){
		_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);

		var labels_all = _.keys(this.model.at(0).get('data')['net_worth']);
    	var labels = ["Today"];
    	for (j=1;j<labels_all.length;j++){
    		labels.push(month_conversion(j));
			//j+=11;
		}
		this.labels = labels;

        this.render();
	},
	render: function(){
		var series_data = [];
		var data_dict_left = this.model.at(0).get('data')['net_worth'];
		var right_model = getActiveModel(this.model);
		if(right_model != false){
			var right_model_name = right_model.get('name');
			var data_dict_right = right_model.get('data')['net_worth'];
			var chart_data_left = [];
			var chart_data_right = [];
			for(i=0;i<_.keys(data_dict_left).length;i++){
				chart_data_left.push(roundToHundreds(data_dict_left[i]));
				chart_data_right.push(roundToHundreds(data_dict_right[i]));
			}
			series_data.push({name:'Base Case',data:chart_data_left});
			series_data.push({name:right_model_name,data:chart_data_right});
			var formatter_fxn = function(){
        		var s = '<b>'+self.labels[this.x]+'</b><br>';
        		var difference = 0;
        		$.each(this.points, function(i, point) {
                    s += point.series.name+' Projected Net Worth: <b>$'+numberWithCommas(roundToHundreds(point.y))+'</b><br>';
                    if(i==0){
                    	difference += point.y;
                    }else{
                    	difference -= point.y;
                    }
                });
                s+= 'Difference: <b>$'+numberWithCommas(roundToHundreds(difference))+'</b>';
        		return s;
            }
			var tooltip = {shared: true, formatter: formatter_fxn};
		}else{ //if there's no active case
			var chart_data_left = [];
			for(i=0;i<_.keys(data_dict_left).length;i++){
				chart_data_left.push(roundToHundreds(data_dict_left[i]));
			}
			series_data.push({name:'Base Case',data:chart_data_left});
			var formatter_fxn = function(){
        		return '<b>'+self.labels[this.x]+'</b><br>'+this.series.name+' Projected Net Worth: <b>$'+numberWithCommas(this.y)+'</b>';
        	}
	        var tooltip = {formatter: formatter_fxn};
		}
		

        var self = this;
		$(function () {
	        $('#net_worth_chart_div').highcharts({
	            chart: {
	                type: 'area'
	            },
	            colors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
	            title: {
	            	text: false
	            },
	            xAxis: {
	                labels: {
	                	formatter: function(){
	                		return self.labels[this.value];
	                	}
	                }
	            },
	            yAxis: {
	                title: {
	                    text: '$USD'
	                },
	                labels: {
	                    formatter: function() {
	                        return this.value / 1000 +'k';
	                    }
	                }
	            },
	            tooltip: tooltip,
	            plotOptions: {
	                area: {
	                    //pointStart: 0,
	                    marker: {
	                        enabled: false,
	                        symbol: 'circle',
	                        radius: 2,
	                        states: {
	                            hover: {
	                                enabled: true
	                            }
	                        }
	                    }
	                }
	            },
	            exporting: {
		        	enabled: false
		        },
		        credits: {
		        	enabled: false
		        },
	            series: series_data
	        });
	    });
	}
});

var CashflowView = Backbone.View.extend({
    initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
        this.render();
    },
    render: function(){
   		// ***** //
		// LEFT  //
		// ***** //
    	var data_left = this.model.at(0).get('data');

    	//calc how long until insolvent
    	var checking_data_left = data_left['cash_accounts']['accounts']['Checking']['items']['ending_balance'];
    	var insolvent_month_left = 0;
    	for(i=1;i<_.keys(checking_data_left).length;i++){
    		if(checking_data_left[i]<=0){
    			insolvent_month_left = i-1;
    			break;
    		}
    	}
    	
    	//build data for expense table
    	var expenses_left = [];
    	var expense_amount_left = 0;
    	var expense_pct_left = 0;
    	var total_income_left = data_left['income']['total'][1];
    	_.each(_.keys(data_left['expenses']['sections']['Basic']['items']),function(key){ 
    		var amount = data_left['expenses']['sections']['Basic']['items'][key][1];
    		if(total_income_left > 0){
    			var pct_of_income = Math.round((amount / total_income_left)*1000) / 10; 
    			expense_pct_left += pct_of_income;
    		}
    		else {
    			var pct_of_income = 'N/A';
    		}
    		expense_amount_left += amount;
    		expenses_left.push({'name':key,'amount':amount,'pct':pct_of_income});
		});
		_.each(_.keys(data_left['expenses']['sections']['Misc']['items']),function(key){ 
    		var amount = data_left['expenses']['sections']['Misc']['items'][key][1];
    		if(total_income_left > 0){
    			var pct_of_income = Math.round((amount / total_income_left)*1000) / 10; 
    			expense_pct_left += pct_of_income;
    		}
    		else {
    			var pct_of_income = 'N/A';
    		}
    		expense_amount_left += amount;
    		expenses_left.push({'name':key,'amount':amount,'pct':pct_of_income});
		});
		_.each(_.keys(data_left['expenses']['sections']['Debt']['items']),function(key){ 
    		if(key.slice(-9,key.length)!='_Optional'){
    			var amount = data_left['expenses']['sections']['Debt']['items'][key][1];
	    		if(total_income_left > 0){
	    			var pct_of_income = Math.round((amount / total_income_left)*1000) / 10; 
	    			expense_pct_left += pct_of_income;
	    		}
	    		else {
	    			var pct_of_income = 'N/A';
	    		}
	    		expense_amount_left += amount;
	    		expenses_left.push({'name':key,'amount':amount,'pct':pct_of_income});
    		}
		});
		expenses_left.sort(function(a,b){
			return b.amount - a.amount;
		});
		if(expense_pct_left == 0) {
			expense_pct_left = 'N/A';
		}
		else {
			expense_pct_left = Math.round(expense_pct_left*100)/100;
		}
		var expenses_totals_left = {'amount':expense_amount_left,'pct':expense_pct_left};




		// ***** //
		// RIGHT  //
		// ***** //
		var model_right = getActiveModel(this.model);
		if(model_right!=false){
			var data_right = model_right.get('data');
		}else{
			var data_right = false;
		}

    	if(data_right != false){
    		//calc how long until insolvent
	    	var checking_data_right = data_right['cash_accounts']['accounts']['Checking']['items']['ending_balance'];
	    	var insolvent_month_right = 0;
	    	for(i=1;i<_.keys(checking_data_right).length;i++){
	    		if(checking_data_right[i]<=0){
	    			insolvent_month_right = i-1;
	    			break;
	    		}
	    	}
	    	
	    	//build data for expense table
	    	var expenses_right = [];
	    	var expense_amount_right = 0;
	    	var expense_pct_right = 0;
	    	var total_income_right = data_right['income']['total'][1];
	    	_.each(_.keys(data_right['expenses']['sections']['Basic']['items']),function(key){ 
	    		var amount = data_right['expenses']['sections']['Basic']['items'][key][1];
	    		if(total_income_right > 0){
	    			var pct_of_income = Math.round((amount / total_income_right)*1000) / 10; 
	    			expense_pct_right += pct_of_income;
	    		}
	    		else {
	    			var pct_of_income = 'N/A';
	    		}
	    		expense_amount_right += amount;
	    		expenses_right.push({'name':key,'amount':amount,'pct':pct_of_income});
			});
			_.each(_.keys(data_right['expenses']['sections']['Misc']['items']),function(key){ 
	    		var amount = data_right['expenses']['sections']['Misc']['items'][key][1];
	    		if(total_income_right > 0){
	    			var pct_of_income = Math.round((amount / total_income_right)*1000) / 10; 
	    			expense_pct_right += pct_of_income;
	    		}
	    		else {
	    			var pct_of_income = 'N/A';
	    		}
	    		expense_amount_right += amount;
	    		expenses_right.push({'name':key,'amount':amount,'pct':pct_of_income});
			});
			_.each(_.keys(data_right['expenses']['sections']['Debt']['items']),function(key){ 
	    		if(key.slice(-9,key.length)!='_Optional'){
	    			var amount = data_right['expenses']['sections']['Debt']['items'][key][1];
		    		if(total_income_right > 0){
		    			var pct_of_income = Math.round((amount / total_income_right)*1000) / 10; 
		    			expense_pct_right += pct_of_income;
		    		}
		    		else {
		    			var pct_of_income = 'N/A';
		    		}
		    		expense_amount_right += amount;
		    		expenses_right.push({'name':key,'amount':amount,'pct':pct_of_income});
	    		}
			});
			expenses_right.sort(function(a,b){
				return b.amount - a.amount;
			});
			if(expense_pct_right == 0) {
				expense_pct_right = 'N/A';
			}
			else {
				expense_pct_right = Math.round(expense_pct_right*100)/100;
			}
			var expenses_totals_right = {'amount':expense_amount_right,'pct':expense_pct_right};
    	}else{
    		var expenses_right = false;
    		var expenses_totals_right  = false;
    		var insolvent_month_right = false;
    	}


		var future_months = ['Jul \'13','Aug \'13','Sep \'13','Oct \'13','Nov \'13','Dec \'13'];

    	var template = _.template( $("#cashflow_template").html(), {expenses_left:expenses_left, expenses_totals_left:expenses_totals_left, data_left:data_left,insolvent_month_left:insolvent_month_left, expenses_right:expenses_right, expenses_totals_right:expenses_totals_right, data_right:data_right,insolvent_month_right:insolvent_month_right,future_months:future_months} );
        this.$el.html( template );

        //build the pie(s)
        var pie_data_left = [];
        pie_data_left.push({name: 'Net Income', y: (((100.0 - expenses_totals_left['pct'])*10)/10), amount:numberWithCommas(data_left['net_income_raw'][1]), sliced: true, selected: true, color:"#47A3FF"});
        for(i=0;i<expenses_left.length;i++) {
        	if(expenses_left[i]['pct'] > 0) {
        		pie_data_left.push({name:expenses_left[i]['name'], y:expenses_left[i]['pct'], amount:numberWithCommas(expenses_left[i]['amount']), color:"#FF6666"});	
        	}
		}

		if(total_income_left == 0 || data_left['net_income_raw'][1] <= 0){
			$('#cashflow_left_pie').remove();
		} else{
			$(function () {
			    $('#cashflow_left_pie').highcharts({
			        chart: {
			            plotBackgroundColor: null,
			            plotBorderWidth: null,
			            plotShadow: false
			        },
			        title: {
			            text: '<strong>Expenses as a Percentage of Total Income</strong>'
			        },
			        tooltip: {
			    	    pointFormat: 'Amount: <b>${point.amount}</b><br>{series.name}: <b>{point.percentage:.1f}%</b>'
			        },
			        plotOptions: {
			            pie: {
			                allowPointSelect: true,
			                cursor: 'pointer',
			                dataLabels: {
			                    enabled: true,
			                    color: '#000000',
			                    connectorColor: '#000000',
			                    format: '<b>{point.name}</b>: {point.percentage:.1f} %'
			                }
			            }
			        },
			        exporting: {
			        	enabled: false
			        },
			        credits: {
			        	enabled: false
			        },
			        series: [{
			            type: 'pie',
			            name: '% of Total Income',
			            data: pie_data_left
			        }]
			    });
			});
		}

		if(data_right != false){
			var pie_data_right = [];
	        pie_data_right.push({name: 'Net Income', y: (((100.0 - expenses_totals_right['pct'])*10)/10), amount:numberWithCommas(data_right['net_income_raw'][1]), sliced: true, selected: true, color:"#47A3FF"});
	        for(i=0;i<expenses_right.length;i++) {
	        	if(expenses_right[i]['pct'] > 0) {
	        		pie_data_right.push({name:expenses_right[i]['name'], y:expenses_right[i]['pct'], amount:numberWithCommas(expenses_right[i]['amount']), color:"#FF6666"});	
	        	}
			}

			if(total_income_right == 0 || data_right['net_income_raw'][1] <= 0){
				$('#cashflow_right_pie').remove();
			} else{
				$(function () {
				    $('#cashflow_right_pie').highcharts({
				        chart: {
				            plotBackgroundColor: null,
				            plotBorderWidth: null,
				            plotShadow: false
				        },
				        title: {
				            text: '<strong>Expenses as a Percentage of Total Income</strong>'
				        },
				        tooltip: {
				    	    pointFormat: 'Amount: <b>${point.amount}</b><br>{series.name}: <b>{point.percentage:.1f}%</b>'
				        },
				        plotOptions: {
				            pie: {
				                allowPointSelect: true,
				                cursor: 'pointer',
				                dataLabels: {
				                    enabled: true,
				                    color: '#000000',
				                    connectorColor: '#000000',
				                    format: '<b>{point.name}</b>: {point.percentage:.1f} %'
				                }
				            }
				        },
				        exporting: {
				        	enabled: false
				        },
				        credits: {
				        	enabled: false
				        },
				        series: [{
				            type: 'pie',
				            name: '% of Total Income',
				            data: pie_data_right
				        }]
				    });
				});
			}
		}
    }
});

var DebtSummaryView = Backbone.View.extend({
    initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);

        var labels_all = _.keys(this.model.at(0).get('data')['net_worth']);
    	var labels = ["Today"];
    	for (j=1;j<labels_all.length;j++){
    		labels.push(month_conversion(j));		
    	}
		this.labels = labels;

		this.render();
    },
    render: function(){
    	var data_left = this.model.at(0).get('data');
    	var debt_accounts_left = data_left['debt_accounts']['accounts'];
    	_.each(_.keys(debt_accounts_left),function(key){
    		if(data_left['debt_accounts']['accounts'][key]['items']['ending_balance'][0] == 0){
    			delete debt_accounts_left[key];
    		}
    	});
    	var debt_totals_left = {"min_payment":0,"WA_rate":0.0};
    	var total_debt_balance_left = data_left['debt_accounts']['total_debt'][1];
    	_.each(_.keys(data_left['debt_accounts']['accounts']), function(key){
    		debt_totals_left['min_payment'] += data_left['debt_accounts']['accounts'][key]['items']['payments'][1];
    		debt_totals_left['WA_rate'] += (data_left['debt_accounts']['accounts'][key]['items']['ending_balance'][1] / total_debt_balance_left) * data_left['debt_accounts']['accounts'][key]['rate'];
    	});

    	var model_right = getActiveModel(this.model);
		if(model_right!=false){
			var data_right = model_right.get('data');
	    	var debt_accounts_right = data_right['debt_accounts']['accounts'];
	    	_.each(_.keys(debt_accounts_right),function(key){
	    		if(data_right['debt_accounts']['accounts'][key]['items']['ending_balance'][0] == 0){
	    			delete debt_accounts_right[key];
	    		}
	    	});
	    	var debt_totals_right = {"min_payment":0,"WA_rate":0.0};
	    	var total_debt_balance_right = data_right['debt_accounts']['total_debt'][1];
	    	_.each(_.keys(data_right['debt_accounts']['accounts']), function(key){
	    		debt_totals_right['min_payment'] += data_right['debt_accounts']['accounts'][key]['items']['payments'][1];
	    		debt_totals_right['WA_rate'] += (data_right['debt_accounts']['accounts'][key]['items']['ending_balance'][1] / total_debt_balance_right) * data_right['debt_accounts']['accounts'][key]['rate'];
	    	});
		}else{
			var data_right = false;
			var debt_accounts_right = false;
			var debt_totals_right = false;
		}
    	

    	var template = _.template( $("#debt_summary_template").html(), {data_left:data_left, debt_accounts_left:debt_accounts_left, debt_totals_left:debt_totals_left,data_right:data_right, debt_accounts_right:debt_accounts_right, debt_totals_right:debt_totals_right} );
        this.$el.html( template );

        if(data_left['debt_accounts']['no_debt'] == false){
			var self = this;
			var datasets_left = [];
	    	_.each(_.keys(debt_accounts_left), function(key){
	    		var data_dict = debt_accounts_left[key]['items']['ending_balance'];
	    		var data_list = []
	    		for (j=0;j<self.labels.length;j++){
	    			if(data_dict[j] > 1) {
	    				data_list.push(data_dict[j]);	
	    			} else {
	    				data_list.push(0);
	    			}
	    		}
	    		var this_dataset = {
	    			name: key,
	    			data: data_list
	    		}
	    		datasets_left.push(this_dataset);
	    	});
	        
			$(function () {
		        $('#debt_chart_left_div').highcharts({
		            chart: {
		                type: 'area'
		            },
		            colors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
		            title: {
		            	text: false
		            },
		            xAxis: {
		                labels: {
		                	formatter: function(){
		                		return self.labels[this.value];
		                	}
		                }
		            },
		            yAxis: {
		                title: {
		                    text: '$USD'
		                },
		                labels: {
		                    formatter: function() {
		                        return this.value / 1000 +'k';
		                    }
		                }
		            },
		            tooltip: {
						shared: true,	            	
		            	formatter: function(){
		            		var s = '<b>'+self.labels[this.x]+'</b><br>';
		            		var total_debt = 0;
		            		$.each(this.points, function(i, point) {
			                    //s += '<br/>'+ point.series.name +': '+ point.y +'m';
			                    s += point.series.name+' Projected Balance: <b>$'+numberWithCommas(roundToHundreds(point.y))+'</b><br>';
			                    total_debt += point.y;
			                });
			                s+= 'Total Debt Projected Balance: <b>$'+numberWithCommas(roundToHundreds(total_debt))+'</b>';
		            		return s;
		            	}
		                //pointFormat: '{series.name} Projected Net Worth: <b>${point.y:,.0f}</b>',
		                
		            },
		            plotOptions: {
		                area: {
		                    //pointStart: 0,
		                    marker: {
		                        enabled: false,
		                        symbol: 'circle',
		                        radius: 2,
		                        states: {
		                            hover: {
		                                enabled: true
		                            }
		                        }
		                    }
		                }
		            },
		            exporting: {
			        	enabled: false
			        },
			        credits: {
			        	enabled: false
			        },
		            series: datasets_left
		        });
		    });
		}
		
		if(data_right!=false){
			if(data_right['debt_accounts']['no_debt'] == false){
				var self = this;
				var datasets_right = [];
		    	_.each(_.keys(debt_accounts_right), function(key){
		    		var data_dict = debt_accounts_right[key]['items']['ending_balance'];
		    		var data_list = []
		    		for (j=0;j<self.labels.length;j++){
		    			if(data_dict[j] > 1) {
		    				data_list.push(data_dict[j]);	
		    			} else {
		    				data_list.push(0);
		    			}
		    		}
		    		var this_dataset = {
		    			name: key,
		    			data: data_list
		    		}
		    		datasets_right.push(this_dataset);
		    	});
		        
				$(function () {
			        $('#debt_chart_right_div').highcharts({
			            chart: {
			                type: 'area'
			            },
			            colors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
			            title: {
			            	text: false
			            },
			            xAxis: {
			                labels: {
			                	formatter: function(){
			                		return self.labels[this.value];
			                	}
			                }
			            },
			            yAxis: {
			                title: {
			                    text: '$USD'
			                },
			                labels: {
			                    formatter: function() {
			                        return this.value / 1000 +'k';
			                    }
			                }
			            },
			            tooltip: {
							shared: true,	            	
			            	formatter: function(){
			            		var s = '<b>'+self.labels[this.x]+'</b><br>';
			            		var total_debt = 0;
			            		$.each(this.points, function(i, point) {
				                    //s += '<br/>'+ point.series.name +': '+ point.y +'m';
				                    s += point.series.name+' Projected Balance: <b>$'+numberWithCommas(roundToHundreds(point.y))+'</b><br>';
				                    total_debt += point.y;
				                });
				                s+= 'Total Debt Projected Balance: <b>$'+numberWithCommas(roundToHundreds(total_debt))+'</b>';
			            		return s;
			            	}
			                //pointFormat: '{series.name} Projected Net Worth: <b>${point.y:,.0f}</b>',
			                
			            },
			            plotOptions: {
			                area: {
			                    //pointStart: 0,
			                    marker: {
			                        enabled: false,
			                        symbol: 'circle',
			                        radius: 2,
			                        states: {
			                            hover: {
			                                enabled: true
			                            }
			                        }
			                    }
			                }
			            },
			            exporting: {
				        	enabled: false
				        },
				        credits: {
				        	enabled: false
				        },
			            series: datasets_right
			        });
			    });
			}
		}
    }
});

var AssetSummaryView = Backbone.View.extend({
    initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
		
        var labels_all = _.keys(this.model.at(0).get('data')['net_worth']);
    	var labels = ["Today"];
    	for (j=1;j<labels_all.length;j++){
    		labels.push(month_conversion(j));		
    	}
		this.labels = labels;
		
		this.render();
    },
    render: function(){
    	var data_left = this.model.at(0).get('data');
    	var cash_accounts_left = data_left['cash_accounts']['accounts'];
    	_.each(_.keys(cash_accounts_left),function(key){
    		if(data_left['cash_accounts']['accounts'][key]['items']['ending_balance'][0] == 0){
    			delete cash_accounts_left[key];
    		}
    	});

    	var WA_rate_left = 0;
    	_.each(_.keys(data_left['cash_accounts']['accounts']), function(key){
    		WA_rate_left += (data_left['cash_accounts']['accounts'][key]['items']['ending_balance'][1] / data_left['cash_accounts']['accounts']['total']) * data_left['cash_accounts']['accounts'][key]['rate'];
    	});
    	if(isNaN(WA_rate_left)){WA_rate_left = 0.0;}

    	
    	var model_right = getActiveModel(this.model);
		if(model_right!=false){
			var data_right = model_right.get('data');
	    	var cash_accounts_right = data_right['cash_accounts']['accounts'];
	    	_.each(_.keys(cash_accounts_right),function(key){
	    		if(data_right['cash_accounts']['accounts'][key]['items']['ending_balance'][0] == 0){
	    			delete cash_accounts_right[key];
	    		}
	    	});

	    	var WA_rate_right = 0;
	    	_.each(_.keys(data_right['cash_accounts']['accounts']), function(key){
	    		WA_rate_right += (data_right['cash_accounts']['accounts'][key]['items']['ending_balance'][1] / data_right['cash_accounts']['accounts']['total']) * data_right['cash_accounts']['accounts'][key]['rate'];
	    	});
	    	if(isNaN(WA_rate_right)){WA_rate_right = 0.0;}
		}else{
			var data_right = false;
			var cash_accounts_right = false;
			var WA_rate_right = false;
		}

    	var template = _.template( $("#asset_summary_template").html(), {
    			data_left:data_left, 
    			cash_accounts_left:cash_accounts_left, 
    			WA_rate_left:WA_rate_left,
    			data_right:data_right, 
    			cash_accounts_right:cash_accounts_right, 
    			WA_rate_right:WA_rate_right
    	});
        this.$el.html( template );

        var self = this;

        // LEFT //
		var datasets_left = [];
    	_.each(_.keys(cash_accounts_left), function(key){
    		var data_dict = cash_accounts_left[key]['items']['ending_balance'];
    		var data_list = []
    		for (j=0;j<self.labels.length;j++){
    			if(data_dict[j] > 1) {
    				data_list.push(data_dict[j]);	
    			} else {
    				data_list.push(0);
    			}
    		}
    		var this_dataset = {
    			name: key,
    			data: data_list
    		}
    		datasets_left.push(this_dataset);
    	});
        
		$(function () {
	        $('#asset_chart_left_div').highcharts({
	            chart: {
	                type: 'area'
	            },
	            colors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
	            title: {
	            	text: false
	            },
	            xAxis: {
	                labels: {
	                	formatter: function(){
	                		return self.labels[this.value];
	                	}
	                }
	            },
	            yAxis: {
	                title: {
	                    text: '$USD'
	                },
	                labels: {
	                    formatter: function() {
	                        return this.value / 1000 +'k';
	                    }
	                }
	            },
	            tooltip: {
					shared: true,	            	
	            	formatter: function(){
	            		var s = '<b>'+self.labels[this.x]+'</b><br>';
	            		var total_assets = 0;
	            		$.each(this.points, function(i, point) {
		                    //s += '<br/>'+ point.series.name +': '+ point.y +'m';
		                    s += point.series.name+' Projected Balance: <b>$'+numberWithCommas(roundToHundreds(point.y))+'</b><br>';
		                    total_assets += point.y;
		                });
		                s+= 'Total Assets Projected Balance: <b>$'+numberWithCommas(roundToHundreds(total_assets))+'</b>';
	            		return s;
	            	}
	                //pointFormat: '{series.name} Projected Net Worth: <b>${point.y:,.0f}</b>',
	                
	            },
	            plotOptions: {
	                area: {
	                    //pointStart: 0,
	                    marker: {
	                        enabled: false,
	                        symbol: 'circle',
	                        radius: 2,
	                        states: {
	                            hover: {
	                                enabled: true
	                            }
	                        }
	                    }
	                }
	            },
	            exporting: {
		        	enabled: false
		        },
		        credits: {
		        	enabled: false
		        },
	            series: datasets_left
	        });
	    });
		
		
		// RIGHT //
		if(data_right != false){
			var datasets_right = [];
	    	_.each(_.keys(cash_accounts_right), function(key){
	    		var data_dict = cash_accounts_right[key]['items']['ending_balance'];
	    		var data_list = []
	    		for (j=0;j<self.labels.length;j++){
	    			if(data_dict[j] > 1) {
	    				data_list.push(data_dict[j]);	
	    			} else {
	    				data_list.push(0);
	    			}
	    		}
	    		var this_dataset = {
	    			name: key,
	    			data: data_list
	    		}
	    		datasets_right.push(this_dataset);
	    	});
        
			$(function () {
		        $('#asset_chart_right_div').highcharts({
		            chart: {
		                type: 'area'
		            },
		            colors: ["rgba(151,187,205,0.5)", "rgba(153,230,153, 0.5)"],
		            title: {
		            	text: false
		            },
		            xAxis: {
		                labels: {
		                	formatter: function(){
		                		return self.labels[this.value];
		                	}
		                }
		            },
		            yAxis: {
		                title: {
		                    text: '$USD'
		                },
		                labels: {
		                    formatter: function() {
		                        return this.value / 1000 +'k';
		                    }
		                }
		            },
		            tooltip: {
						shared: true,	            	
		            	formatter: function(){
		            		var s = '<b>'+self.labels[this.x]+'</b><br>';
		            		var total_assets = 0;
		            		$.each(this.points, function(i, point) {
			                    //s += '<br/>'+ point.series.name +': '+ point.y +'m';
			                    s += point.series.name+' Projected Balance: <b>$'+numberWithCommas(roundToHundreds(point.y))+'</b><br>';
			                    total_assets += point.y;
			                });
			                s+= 'Total Assets Projected Balance: <b>$'+numberWithCommas(roundToHundreds(total_assets))+'</b>';
		            		return s;
		            	}
		                //pointFormat: '{series.name} Projected Net Worth: <b>${point.y:,.0f}</b>',
		                
		            },
		            plotOptions: {
		                area: {
		                    //pointStart: 0,
		                    marker: {
		                        enabled: false,
		                        symbol: 'circle',
		                        radius: 2,
		                        states: {
		                            hover: {
		                                enabled: true
		                            }
		                        }
		                    }
		                }
		            },
		            exporting: {
			        	enabled: false
			        },
			        credits: {
			        	enabled: false
			        },
		            series: datasets_right
		        });
		    });
		}
		
    }
});

var ActiveCaseView = Backbone.View.extend({
	initialize: function(){
    	_.bindAll(this, 'render');
		this.listenTo(this.model, 'add change destroy', this.render);
		this.render();
	},
	render: function(){
		var cases = [];
		this.model.each(function(model){
			if(model.get('isBaseCase')!=true){
				cases.push({name:model.get('name'),id:model.cid});
			}
		});

		var template = _.template( $("#active_case_template").html(), {cases:cases} );
    	this.$el.html( template );
	},
	events: {
		"change #active_case": "setActiveCase"
	},
	setActiveCase: function(){
		console.log('yep');
		console.log($('#active_case').val());
		/*
		var this_model = false;
		this.model.each(function(model){
			if(model.get('isActive')==true){
				this_model = model;
			}
		});
		*/
	}
})


</script>

<script type="text/javascript">
$(document).ready(function() {
	$global_fieldnames = []
	$first_other_id = false;

	var caseCollection = new CaseCollection();
	var parentView = new ParentView({el:$("#input_left"), model: caseCollection});

	var buildExistingCases = function(input_id) {
		var this_model = new Case({id: input_id});
		this_model.fetch({
			success: function(){
				if($first_other_id==false){
					this_model.set({isActive:true})
					$first_other_id = true;
				}
				caseCollection.add(this_model);
			}
		});	
	}
	{% for this_id in other_ids %}
		buildExistingCases({{this_id}});
	{% endfor %}
	
	

	$('#back_to_output').live('click',function(){
		$('#input').addClass('hidden');
		$('#cases').addClass('hidden');
		$('#output').removeClass('hidden');
		$(this).addClass('hidden');
		$('#back_to_input').removeClass('hidden');
		$('#show_cases').removeClass('hidden');
	});
	$('#back_to_input').live('click',function(){
		$('#output').addClass('hidden');
		$('#cases').addClass('hidden');
		$('#input').removeClass('hidden');
		$(this).addClass('hidden');
		$('#back_to_output').removeClass('hidden');
		$('#show_cases').removeClass('hidden');
	});
	$('#show_cases').live('click',function(){
		$('#input').addClass('hidden');
		$('#output').addClass('hidden');
		$('#cases').removeClass('hidden');
		$(this).addClass('hidden');
		$('#back_to_input').removeClass('hidden');
		$('#back_to_output').removeClass('hidden');
	});

	$('#new_scenario').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var new_model = new Case({
				name:$case_name,
				data:base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
		//caseCollection.at(1).save({isActive:true});
		//console.log(caseCollection.at(1));
    	return false;
	});
	$('#new_scenario1').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var be = $.extend(true, {}, base_model.get('basic_expenses'));
		be['Housing'] = be['Housing'] * 0.8;
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: be,
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario2').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var inc = $.extend(true, {}, base_model.get('income_items'));
		inc['Salary'] = inc['Salary'] * 1.1;
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: inc,
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario3').live('click', function(){
		var accounts = null;
		caseCollection.each(function(model){
			accounts = model.get('cash_accounts');
			accounts['Inheritance'] = {'balance':0,'rate':0};
			model.set({cash_accounts:accounts});
			model.trigger('change');
		});
		Case.prototype.defaults.cash_accounts = accounts;
		
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var ca = $.extend(true, {}, base_model.get('cash_accounts'));
		ca['Inheritance'] = {'balance':40000,'rate':5};

		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: base_model.get('debt_accounts'),
				cash_accounts: ca
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});
	$('#new_scenario4').live('click', function(){
		$case_name = prompt('Enter new scenario name: ');
		var base_model = caseCollection.at(0);
		var da = $.extend(true, {}, base_model.get('debt_accounts'));
		for (var key in da) {
			da[key]['balance'] = 0;
			da[key]['payment'] = 0;
		}
		var new_model = new Case({
				name:$case_name,
				data: base_model.get('data'),
				income_items: base_model.get('income_items'),
				basic_expenses: base_model.get('basic_expenses'),
				misc_expenses: base_model.get('misc_expenses'),
				debt_accounts: da,
				cash_accounts: base_model.get('cash_accounts')
			});
		caseCollection.add(new_model);
		//$('.dropdown-toggle').click();
    	return false;
	});

	$('#it_flatline').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'flatline','frequency':'monthly','value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_pct_change').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'pct_change','frequency':'monthly','change':0,'change_frequency':'year','change_direction':'increases','change_periods':1,'value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_val_change').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'val_change','frequency':'monthly','change':0,'change_frequency':'year','change_direction':'increases','change_periods':1,'value':0};
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#it_custom').live('click',function(){
		$parent = $(this).closest('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		items[$name] = {'type':'custom','data': [ {'value':0,'frequency':'monthly','start_mo':6,'start_yr':2013,'end_mo':7,'end_yr':2013} ] };
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});
	$('#new_custom_input_block').live('click',function(){
		$parent = $(this).parent().prev().children('.dropdown-menu');
		$section = $parent.attr('data-section');
		$name = $parent.attr('data-name');
		$id = $parent.attr('data-id');
		var model = caseCollection.get($id);
		var items = model.get($section);
		/*
		$last_item = items[$name]['data'][items[$name]['data'].length-1];
		alert($last_item);
		items[$name]['data'].push({'value':$last_item['value'],'frequency':$last_item['frequency'],'start_mo':($last_item['end_mo']+1),'start_yr':2013,'end_mo':($last_item['end_mo']+2),'end_yr':2013});
		*/
		//implement the above eventually - obviously needs to wrap around the year if the next month is >12
		items[$name]['data'].push({'value':0,'frequency':'monthly','start_mo':7,'start_yr':2013,'end_mo':8,'end_yr':2013});
		if($section == 'basic_expenses') {
			var context = {basic_expenses:items};
		}
		else if ($section == 'misc_expenses'){
			var context = {misc_expenses:items};
		}
		else if ($section == 'income_items') {
			var context = {income_items:items};
		}
		model.set(context);
		model.trigger('change');
		return false;
	});



	$('#new_in').live('click',function(){
		//while (true) {
		//	$fieldname = prompt('Enter Item Name');
		//	if ($fieldname != null && $fieldname != '') {
		//		if($global_fieldnames.indexOf($fieldname.toLowerCase()) == -1) {

		/*
				}
				else {
					alert('You already have an item with the name \"'+$fieldname+'\".\r\nPlease use a new, unique name.');
				}
			}
			else {
				break;
			}	
		}
		*/
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			//console.log(_.size(parentView.caseViews));
			var in_items = null;
			//for (var case_number in parentView.caseViews){
			caseCollection.each(function(model){
				in_items = model.get('income_items');
				in_items[$fieldname] = {'type':'flatline','frequency':'monthly','value':0};
				//console.log(in_items);
				model.set({income_items:in_items});
				//console.log(parentView.caseViews[case_number].model.get('income_items'));
				//console.log('ok');
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.income_items = in_items;
		//});
	});
	$('#new_be').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var be_items = null;
			caseCollection.each(function(model){
				be_items = model.get('basic_expenses');
				//be_items[$fieldname] = 0;
				be_items[$fieldname] = {'type':'flatline','frequency':'monthly','value':0};
				model.set({basic_expenses:be_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.basic_expenses = be_items;
		//});
	});
	$('#new_me').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var me_items = null;
			caseCollection.each(function(model){
				me_items = model.get('misc_expenses');
				me_items[$fieldname] = 0;
				model.set({misc_expenses:me_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.misc_expenses = me_items;
		//});
	});
	$('#new_da').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('debt_accounts');
				accounts[$fieldname] = {'payment':0,'balance':0,'rate':0};
				model.set({debt_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.debt_accounts = accounts;
		//});
	});
	$('#new_ca').live('click',function(){
		//parentView.save_input_data(function() {
			$fieldname = prompt('Enter Item Name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('cash_accounts');
				accounts[$fieldname] = {'balance':0,'rate':0};
				model.set({cash_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.cash_accounts = accounts;
		//});
	});

	$('#delete_in').live('click',function(){
		self = this;
		//parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var in_items = null;
			caseCollection.each(function(model){
				in_items = model.get('income_items');
				delete in_items[$fieldname];
				model.set({income_items:in_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.income_items = in_items;
		//});
	});
	$('#delete_be').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var be_items = null;
			caseCollection.each(function(model){
				be_items = model.get('basic_expenses');
				delete be_items[$fieldname];
				model.set({basic_expenses:be_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.be_items = be_items;
		});
	});
	$('#delete_me').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var me_items = null;
			caseCollection.each(function(model){
				me_items = model.get('misc_expenses');
				delete me_items[$fieldname];
				model.set({misc_expenses:me_items});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.me_items = me_items;
		});
	});
	$('#delete_da').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var accounts = null;
			caseCollection.each(function(model){
				accounts = model.get('debt_accounts');
				delete accounts[$fieldname];
				model.set({debt_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.debt_accounts = accounts;
		});
	});
	$('#delete_ca').live('click',function(){
		self = this;
		parentView.save_input_data(function() {
			$fieldname = $(self).attr('data-name');
			var accounts
			caseCollection.each(function(model){
				accounts = model.get('cash_accounts');
				delete accounts[$fieldname];
				model.set({cash_accounts:accounts});
			});
			caseCollection.trigger('change');
			Case.prototype.defaults.cash_accounts = accounts;
		});
	});

	$('.delete_scenario').live('click',function() {
		$cid = $(this).attr('data-id');
		//console.log($cid);
		caseCollection.get($cid).destroy({success:function(){console.log('destroyed')}});
	});


});

</script>

{% endblock %}

{% block main %}


<div id="input" style="margin:30px;margin-top:90px;width:960px;">
	<div id="input_left" style="float:left;width:700px;"></div>
	<div id="input_right" style="float:right;width:200px;"></div>
	
</div>

<div id="output" style="margin-top:90px;" class="hidden">
	<div class="content_box">
		<div class="output_section_header" style="margin-top:0px;">
			<h2>Net Worth</h2>
		</div>
		<div id="net_worth_chart" style="text-align:center;">
			<div><h3>Projected Net Worth over Time</h3></div>
			<!--canvas id="net_worth_chart_canvas" width="800" height="400" style="display: inline;"></canvas-->
			<div id="net_worth_chart_div" style="display:inline-block;width:800px;"> </div>
			<div id="net_worth_chart_legend"></div>
		</div>
		<div id="net_worth_tables"></div>
		<!--div class="form_section_divider" style="margin-top:80px;"></div-->
		<div class="output_section_header">
			<h2>Cash Flow</h2>
		</div>
		<!--div id="chart2" style="width: 800px; height: 400px; margin: 0 auto;text-align:center;"></div-->
		<div id="cashflow_section"></div>
		<!--div class="form_section_divider" style="margin-top:80px;"></div-->
		<div class="output_section_header">
			<h2>Debt Summary</h2>
		</div>
		<div id="debt_summary_section"></div>
		<div class="output_section_header">
			<h2>Asset Summary</h2>
		</div>
		<div id="asset_summary_section"></div>
	</div>
</div>

<div id="cases" style="margin-top:90px;" class="hidden">
	<div id="cases_div" class="content_box"></div>
</div>

{% endblock %}